<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IPLD Specifications</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Specifications for the Inter-planetary Linked Data project">
    
    <link rel="preload" href="/assets/css/0.styles.1c4fef16.css" as="style"><link rel="preload" href="/assets/js/app.398f8b12.js" as="script"><link rel="preload" href="/assets/js/2.47786eef.js" as="script"><link rel="preload" href="/assets/js/54.73b115f3.js" as="script"><link rel="prefetch" href="/assets/js/10.fc6aff28.js"><link rel="prefetch" href="/assets/js/100.6ea9f1c4.js"><link rel="prefetch" href="/assets/js/101.8a3976e5.js"><link rel="prefetch" href="/assets/js/102.e13df111.js"><link rel="prefetch" href="/assets/js/103.b0f7d528.js"><link rel="prefetch" href="/assets/js/11.237acee7.js"><link rel="prefetch" href="/assets/js/12.7b311b3e.js"><link rel="prefetch" href="/assets/js/13.a9c55d15.js"><link rel="prefetch" href="/assets/js/14.d7da8be6.js"><link rel="prefetch" href="/assets/js/15.9c985ac3.js"><link rel="prefetch" href="/assets/js/16.3bc612d6.js"><link rel="prefetch" href="/assets/js/17.eb822ab7.js"><link rel="prefetch" href="/assets/js/18.9bece705.js"><link rel="prefetch" href="/assets/js/19.f342a28d.js"><link rel="prefetch" href="/assets/js/20.1ea1c788.js"><link rel="prefetch" href="/assets/js/21.9483d0be.js"><link rel="prefetch" href="/assets/js/22.28df1156.js"><link rel="prefetch" href="/assets/js/23.e106896f.js"><link rel="prefetch" href="/assets/js/24.136d8b68.js"><link rel="prefetch" href="/assets/js/25.4652b127.js"><link rel="prefetch" href="/assets/js/26.abdb7c5a.js"><link rel="prefetch" href="/assets/js/27.81f3a367.js"><link rel="prefetch" href="/assets/js/28.45622476.js"><link rel="prefetch" href="/assets/js/29.226cb870.js"><link rel="prefetch" href="/assets/js/3.97cbb82f.js"><link rel="prefetch" href="/assets/js/30.3ad9b46b.js"><link rel="prefetch" href="/assets/js/31.080b29ba.js"><link rel="prefetch" href="/assets/js/32.ac85b868.js"><link rel="prefetch" href="/assets/js/33.37d682bf.js"><link rel="prefetch" href="/assets/js/34.0313a448.js"><link rel="prefetch" href="/assets/js/35.b70107b9.js"><link rel="prefetch" href="/assets/js/36.f083e171.js"><link rel="prefetch" href="/assets/js/37.3f6e7002.js"><link rel="prefetch" href="/assets/js/38.9c81347c.js"><link rel="prefetch" href="/assets/js/39.04e4f4bd.js"><link rel="prefetch" href="/assets/js/4.154d6850.js"><link rel="prefetch" href="/assets/js/40.56fa69df.js"><link rel="prefetch" href="/assets/js/41.d6054697.js"><link rel="prefetch" href="/assets/js/42.ddcb2fb3.js"><link rel="prefetch" href="/assets/js/43.a4fa6d45.js"><link rel="prefetch" href="/assets/js/44.c33b7e26.js"><link rel="prefetch" href="/assets/js/45.2dd58966.js"><link rel="prefetch" href="/assets/js/46.ca835d79.js"><link rel="prefetch" href="/assets/js/47.575b064e.js"><link rel="prefetch" href="/assets/js/48.fd7338ca.js"><link rel="prefetch" href="/assets/js/49.dae162f5.js"><link rel="prefetch" href="/assets/js/5.05324856.js"><link rel="prefetch" href="/assets/js/50.80c89777.js"><link rel="prefetch" href="/assets/js/51.fdc143c4.js"><link rel="prefetch" href="/assets/js/52.2d2e8810.js"><link rel="prefetch" href="/assets/js/53.7ec404bd.js"><link rel="prefetch" href="/assets/js/55.6850da89.js"><link rel="prefetch" href="/assets/js/56.74142523.js"><link rel="prefetch" href="/assets/js/57.f0a1ff10.js"><link rel="prefetch" href="/assets/js/58.e26a767b.js"><link rel="prefetch" href="/assets/js/59.66403a90.js"><link rel="prefetch" href="/assets/js/6.6e2dfd78.js"><link rel="prefetch" href="/assets/js/60.2741bf4a.js"><link rel="prefetch" href="/assets/js/61.c9ca4d9a.js"><link rel="prefetch" href="/assets/js/62.b054847f.js"><link rel="prefetch" href="/assets/js/63.6c80aa00.js"><link rel="prefetch" href="/assets/js/64.e78c4a3c.js"><link rel="prefetch" href="/assets/js/65.6cad650a.js"><link rel="prefetch" href="/assets/js/66.e024d09a.js"><link rel="prefetch" href="/assets/js/67.9bd38c4d.js"><link rel="prefetch" href="/assets/js/68.3cd1c085.js"><link rel="prefetch" href="/assets/js/69.163e6a1c.js"><link rel="prefetch" href="/assets/js/7.e86b86be.js"><link rel="prefetch" href="/assets/js/70.3cd614d6.js"><link rel="prefetch" href="/assets/js/71.1d12e379.js"><link rel="prefetch" href="/assets/js/72.521e4e34.js"><link rel="prefetch" href="/assets/js/73.64a2f981.js"><link rel="prefetch" href="/assets/js/74.6a3b5afa.js"><link rel="prefetch" href="/assets/js/75.f90776b8.js"><link rel="prefetch" href="/assets/js/76.bb92253c.js"><link rel="prefetch" href="/assets/js/77.b276ca6e.js"><link rel="prefetch" href="/assets/js/78.d3de5c03.js"><link rel="prefetch" href="/assets/js/79.8f505fec.js"><link rel="prefetch" href="/assets/js/8.b12cf945.js"><link rel="prefetch" href="/assets/js/80.60d82f9e.js"><link rel="prefetch" href="/assets/js/81.b9b7539f.js"><link rel="prefetch" href="/assets/js/82.2dc1b099.js"><link rel="prefetch" href="/assets/js/83.a89da852.js"><link rel="prefetch" href="/assets/js/84.9b9c8a03.js"><link rel="prefetch" href="/assets/js/85.a340ac2f.js"><link rel="prefetch" href="/assets/js/86.34d52046.js"><link rel="prefetch" href="/assets/js/87.3ee6f7ee.js"><link rel="prefetch" href="/assets/js/88.d184aae2.js"><link rel="prefetch" href="/assets/js/89.4a2a44c2.js"><link rel="prefetch" href="/assets/js/9.497fa810.js"><link rel="prefetch" href="/assets/js/90.f5d33a75.js"><link rel="prefetch" href="/assets/js/91.0c08a7a6.js"><link rel="prefetch" href="/assets/js/92.8279b4c4.js"><link rel="prefetch" href="/assets/js/93.da2c14ed.js"><link rel="prefetch" href="/assets/js/94.596d7cbf.js"><link rel="prefetch" href="/assets/js/95.94d00784.js"><link rel="prefetch" href="/assets/js/96.3c524265.js"><link rel="prefetch" href="/assets/js/97.084146b1.js"><link rel="prefetch" href="/assets/js/98.8cd5de75.js"><link rel="prefetch" href="/assets/js/99.33255290.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c4fef16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">IPLD Specifications</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design/history/exploration-reports/2018.10-selectors.html#approach-selector-types" class="sidebar-link">Approach: Selector Types</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/history/exploration-reports/2018.10-selectors.html#selector-types" class="sidebar-link">Selector Types</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2018.10-selectors.html#cid-selector" class="sidebar-link">Cid Selector</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2018.10-selectors.html#path-selector" class="sidebar-link">Path Selector</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2018.10-selectors.html#glob-selector" class="sidebar-link">Glob Selector</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2018.10-selectors.html#multi-selector" class="sidebar-link">Multi Selector</a></li></ul></li><li><a href="/design/history/exploration-reports/2018.10-selectors.html#ipld-interfaces-in-go-with-selectors" class="sidebar-link">IPLD Interfaces in Go with Selectors</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>This document was archived from https://github.com/ipld/specs/issues/94 and was originally part of the <a href="https://github.com/ipld/specs/pull/75" target="_blank" rel="noopener noreferrer">Graphsync (b) proposal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> by @jbenet.</p> <h2 id="approach-selector-types"><a href="#approach-selector-types" class="header-anchor">#</a> Approach: Selector Types</h2> <p>The requirements stated <a href="/design/history/exploration-reports/2018.10-selectors-design-goals.html#selector-requirements">here</a> are hard to meet. We have spent lots of time in the last few years trying to reconcile them into one language and syntax, with no success. Earlier this year (2018) we recognized that the solution to this problem should be flexibility and interoperability: let many selector languages and syntaxes flourish, and let them evolve over time. This would allow us to satisfy all constraints, including both a permanent model that can also improve over time. And it reduces the core of our system into three components:</p> <ul><li>(1) A system of selector types, that allows creating new selector languages and syntaxes, and can compose them.</li> <li>(2) An easy path for plugging selector types into IPLD libraries and other consumers of IPLD Selectors.</li> <li>(3) A light process for testing and admitting new selector types into standard IPLD libraries.</li></ul> <p>These components imply or expand into the following things:</p> <ul><li>Well-defined binary and human-readable type self-description (codes in multicodec).</li> <li>A narrow <code>Selector</code> interface for most uses of selectors, agnostic to selector type.</li> <li>A standard way to add selector type implementations to IPLD libraries</li> <li>IPLD libraries that pervasively uses the abstract  <code>Selector</code> type, and can plug in concrete types.</li> <li>A few simple selector types that cover most common cases (cid, path, glob, ...)</li> <li>A selector type to allow composing selectors (MultiSelector)</li> <li>Aim for language independent implementations of selector implementations (parsers, execution, etc). (WASM?)</li> <li>Allow language-specific implementations of selectors (parsers, execution, etc).</li> <li>(IMPORTANT) Well-designed set of test vectors representing a variety of use cases for IPLD Selectors.</li> <li>A recommended structure for implementing a selector type, with an easy to use test suite.</li></ul> <h2 id="selector-types"><a href="#selector-types" class="header-anchor">#</a> Selector Types</h2> <p>Selectors have multiple types</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;selector-code&gt; &lt;selector-string-code&gt; &lt;selector-type&gt;
0, null, selects the empty set
1, cid, selects a specific cid
2, path, selects an ipld path
3, glob, selects a unix-style glob
4, multi, combines multiple selectors
5, css, selects in css style
6, git, selects with git tilde notation
7, bitfield, selects all the nodes expressed in a bitfield
</code></pre></div><p><strong>TODO</strong>: put selectors into the grand magnificent global universal multicodec table...</p> <h3 id="cid-selector"><a href="#cid-selector" class="header-anchor">#</a> Cid Selector</h3> <p>This is a basic selector, that means exactly a single CID, and thus a single graph node. Nothing more.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Binary: &lt;selector-code&gt;&lt;length&gt;&lt;cid-selector-code&gt;&lt;binary-cid&gt;</span>
<span class="token comment">//     or: &lt;cid-selector-code&gt;&lt;binary-cid&gt;</span>
<span class="token comment">// String: /sel/cid/&lt;multibase-encoded-cid&gt;</span>
<span class="token keyword">type</span> CidSelector <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Cid Cid <span class="token comment">// el cid</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="path-selector"><a href="#path-selector" class="header-anchor">#</a> Path Selector</h3> <p>This is a selector w/ a path. Absolute ones must start with a CID</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Binary: &lt;selector-code&gt;&lt;length&gt;&lt;path-selector-code&gt;&lt;binary-cid&gt;&lt;binary-path&gt;</span>
<span class="token comment">//     or: &lt;path-selector-code&gt;&lt;length&gt;&lt;binary-path&gt;</span>
<span class="token comment">// String: /sel/path/&lt;multibase-encoded-cid&gt;/a/b/c/d/...</span>
<span class="token keyword">type</span> PathSelector <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Path Path
<span class="token punctuation">}</span>
</code></pre></div><h3 id="glob-selector"><a href="#glob-selector" class="header-anchor">#</a> Glob Selector</h3> <p>This is a selector with a <a href="https://en.wikipedia.org/wiki/Glob_(programming)" target="_blank" rel="noopener noreferrer">unix shell glob<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> style thing. Absolute ones must start with a CID. It supports the following syntax:</p> <ul><li><code>*</code> - means any number of single characters, except <code>/</code> -- ie matches any link within a level (as in shell <code>*</code>)</li> <li><code>**</code> - means any decendant (as in shell <code>**</code>)</li> <li><code>?</code> - matches any single character</li> <li><code>{abc,def}</code> - means either <code>abc</code> or <code>def</code></li> <li>[abc] - matches one character in the bracket set.</li> <li>[a-z] - matches one character from the (locale-dependent) range given in the bracket.</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Binary: &lt;selector-code&gt;&lt;length&gt;&lt;glob-selector-code&gt;&lt;binary-cid&gt;&lt;binary-path&gt;</span>
<span class="token comment">//     or: &lt;glob-selector-code&gt;&lt;length&gt;&lt;binary-path&gt;</span>
<span class="token comment">// String: /sel/path/&lt;multibase-encoded-cid&gt;/a/*/**</span>
<span class="token keyword">type</span> GlobSelector <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Glob Path
<span class="token punctuation">}</span>
</code></pre></div><h3 id="multi-selector"><a href="#multi-selector" class="header-anchor">#</a> Multi Selector</h3> <p>This is a selector that combines other selectors. It is a set expression.</p> <ul><li><code>union</code> ($$ A \cup B $$) - takes all nodes expressed by either selectors (A <em>or</em> B)</li> <li><code>intersection</code> ($$ A \cap B $$) - takes all nodes expressed by both selectors (A <em>and</em> B)</li> <li><code>difference</code> ($$ A - B $$) - takes all nodes expressed in A, except those expressed in B (A <em>except</em> B)</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Binary: &lt;selector-code&gt;&lt;length&gt;&lt;multi-selector-code&gt;&lt;sel-sexp&gt;</span>
<span class="token comment">//     or: &lt;multi-selector-code&gt;&lt;length&gt;&lt;sel-sexp&gt;</span>
<span class="token comment">// String: /sel/multi/(string sel sexp)</span>
<span class="token comment">//       no can do</span>
<span class="token keyword">type</span> MultiSelector <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Op   Operator
    Sels <span class="token punctuation">[</span><span class="token punctuation">]</span>Selector
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Operator <span class="token builtin">int</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
  OpUnion        Operator <span class="token operator">=</span> <span class="token number">1</span>
    OpIntersection Operator <span class="token operator">=</span> <span class="token number">2</span>
    OpDifference   Operator <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">)</span>
</code></pre></div><h4 id="selector-s-expressions-sel-sexp"><a href="#selector-s-expressions-sel-sexp" class="header-anchor">#</a> Selector S-expressions (<code>sel-sexp</code>)</h4> <p><a href="https://en.wikipedia.org/wiki/S-expression" target="_blank" rel="noopener noreferrer">S-expressions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are a simple way to combine objects into nested expressions. We define this in order to have Multi Selectors. A selector s-expression (<code>sel-sexp</code>) is defined as follows.</p> <p>Option 1 - simpler, need to nest another multiselector to nest another expression (this seems better).</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;sel-sexp&gt;  ::= &lt;varint-2+&gt;&lt;operator&gt;(&lt;selector&gt;)+
</code></pre></div><p>Option 2: more complicated at the <code>sel-sexp</code> level, but avoids having to embed the multiselector preamble.</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;sel-sexp&gt;  ::= &lt;varint-0&gt; |
                &lt;varint-1&gt;&lt;selector&gt; |
                &lt;varint-2+&gt;&lt;operator&gt;(&lt;sel-sexp&gt;)+

&lt;operator&gt;  ::= 1 (union) | 2 (intersection) | 3 (difference)
&lt;varint-0&gt;  ::= 0
&lt;varint-1&gt;  ::= 1
&lt;varint-2+&gt; ::= 2 or more (in a varint)
</code></pre></div><h2 id="ipld-interfaces-in-go-with-selectors"><a href="#ipld-interfaces-in-go-with-selectors" class="header-anchor">#</a> IPLD Interfaces in Go with Selectors</h2> <p>This section presents a set of possible interfaces in Go, using IPLD dags and selectors. The main purpose of this example is to show how the Selector interfaces might work in practice.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    <span class="token comment">// ErrNotFound is returned when an object is not found at a particular dag.</span>
    ErrNotFound <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;not found&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// ErrInvalidPath is returned when a path is not</span>
    ErrInvalidPath <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid path&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// DAG is an object that provides access to an entire IPLD dag.</span>
<span class="token comment">// It provides a handle to a set of data, all of which is rooted at one</span>
<span class="token comment">// node (the Root).</span>
<span class="token comment">// The interface is very simple, it only provides the Root, GetNode to retrieve</span>
<span class="token comment">// any sub-object by path, and Traverse, to use in algorithms that need to</span>
<span class="token comment">// sub-select or visit the entire dag.</span>
<span class="token comment">// This could be entirely in memory, lazy-loaded, backed by a DagService,</span>
<span class="token comment">// or be a proxy to a remote dag.</span>
<span class="token keyword">type</span> DAG <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// Root returns the Path of the ipld node that is the root of this DAG</span>
    <span class="token comment">// We return the Path to avoid returning an error, as returning</span>
    <span class="token comment">// the node itself may fail.</span>
    <span class="token function">Root</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Path

    <span class="token comment">// GetNode returns an object identified by path.</span>
    <span class="token comment">// Path may be absolute (start with a CID), or relative (from the root),</span>
    <span class="token comment">// similar to how directories work in Unix filesystems.</span>
    <span class="token comment">// Either way, the node returned MUST be a descendant of Root().</span>
    <span class="token comment">// rest is the remainder if the Path, if any is left. if rest is not empty,</span>
    <span class="token comment">// then err is not nil (ErrInvalidPath or ErrNotFound).</span>
    <span class="token comment">// The return error may be ErrNotFound, ErrInvalidPath, or errors</span>
    <span class="token comment">// propagated from underlying systems.</span>
    <span class="token function">GetNode</span><span class="token punctuation">(</span>path Path<span class="token punctuation">)</span> <span class="token punctuation">(</span>n Node<span class="token punctuation">,</span> rest Path<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>

    <span class="token comment">// Traverse returns a Traverser object to walk through this whole Dag.</span>
    <span class="token comment">// See the Traverser documentation for how to use it.</span>
    <span class="token function">Traverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Traverser
<span class="token punctuation">}</span>


<span class="token comment">// Traverser is an object that traverses a particular dag. Think of it like</span>
<span class="token comment">// an iterator over the whole dag. This object is in principle similar to</span>
<span class="token comment">// traversals like os.Walk, to iterators in c++/rust, to generators in Python,</span>
<span class="token comment">// etc.</span>
<span class="token comment">//</span>
<span class="token comment">// The implementation of a traverser is highly Dag depenedent, thus usually</span>
<span class="token comment">// an implementation of Dag will have a specific Traverser associated with it.</span>
<span class="token comment">//</span>
<span class="token comment">// Traversers support filtering via selectors, which is an important feature.</span>
<span class="token comment">// Instead of requiring wrapping/nesting traversers (expensive), we allow</span>
<span class="token comment">// filtering a single traverser with multiple selectors instead (much cheaper).</span>
<span class="token comment">// This allows the logic of checking whether to consider a node to be applied</span>
<span class="token comment">// efficiently, ideally before the node is fetched.</span>
<span class="token comment">//</span>
<span class="token comment">// TODO:</span>
<span class="token comment">// - address skipping links, as in os.Walk. Maybe turn into a walk function.</span>
<span class="token comment">// - return only the Path, not the node (avoid retrieving it if not needed?).</span>
<span class="token comment">//   this is similar to how os.Walk works.</span>
<span class="token keyword">type</span> Traverser <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token comment">// Next returns the next node visited by this Traverser</span>
  <span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Path<span class="token punctuation">,</span> Node<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

  <span class="token comment">// Filter adds a new selector to filter the nodes the Traverser will return</span>
  <span class="token function">Filter</span><span class="token punctuation">(</span>sel Selector<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Selector is an object that expresses a sub-selection on a graph.</span>
<span class="token comment">//</span>
<span class="token comment">// For a more complete articulation of selectiors, read the IPLD selector</span>
<span class="token comment">// design document.</span>
<span class="token comment">//</span>
<span class="token comment">// Note that selectors have different types, and each type will need its</span>
<span class="token comment">// own Go object. User code should use the selector interface and avoid</span>
<span class="token comment">// assuming a specific type of selector. Types are identified using a code,</span>
<span class="token comment">// agreed upon in the multicodec table.</span>
<span class="token comment">//</span>
<span class="token comment">// The selector interface in Go is a simple construct that enables reducing</span>
<span class="token comment">// a dag to a subset represented in a concise selector expression. All it</span>
<span class="token comment">// does is check whether a path is included in the selector (IncludesPath).</span>
<span class="token comment">// Using this, other objects (like the Traverser) can reduce a Dag to only</span>
<span class="token comment">// the subdag represented by the selector.</span>
<span class="token comment">//</span>
<span class="token comment">// Important note: selectors select a subdag that is also connected to the</span>
<span class="token comment">// same dag root. Whatever nodes are selected by the selector must</span>
<span class="token comment">// include paths going all the way back to the root. There are no nodes</span>
<span class="token comment">// selected that are disconnected from the root -- at least one of their parents</span>
<span class="token comment">// (linked-from relationship) must also be selected.</span>
<span class="token comment">//</span>
<span class="token comment">// Serialization</span>
<span class="token comment">// - Selectors have both string and binary representations. These are canonical</span>
<span class="token comment">//   and can be used in a variety of places.</span>
<span class="token comment">// - The binary representation should be used in memory, on the wire, on disk, etc.</span>
<span class="token comment">// - The string representation should be used whenever a selector is shown to the</span>
<span class="token comment">//   user, or when the user is inputting a selector. It can also be used in other</span>
<span class="token comment">//   formats that aim to have high human readability (eg package.json, etc).</span>
<span class="token keyword">type</span> Selector <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// IncludesPath returns whether path p is included in this selector,</span>
    <span class="token comment">// as applied to dag d.</span>
    <span class="token comment">//</span>
    <span class="token comment">// d is necessary in order to have a handle to the</span>
    <span class="token comment">// whole dag. Selector objects themselves should be cheap and not</span>
    <span class="token comment">// link to huge amounts of data.</span>
    <span class="token function">IncludesPath</span><span class="token punctuation">(</span>d Dag<span class="token punctuation">,</span> p Path<span class="token punctuation">)</span> <span class="token builtin">bool</span>

    <span class="token comment">// IsAbsolute returns whether the selector is absolute (rooted at a specific</span>
    <span class="token comment">// cid in the serialized expression) or not. If it's not, it is relative,</span>
    <span class="token comment">// which means there is no cid in the expression, and thus the selector</span>
    <span class="token comment">// root is the root of the dag it is applied to. Intuitively, this works</span>
    <span class="token comment">// exactly the same as shell globs in unix filesystems:</span>
    <span class="token comment">// - Absolute: /foo/bar/baz/**/*  -&gt; &lt;root-cid&gt;/bar/baz/**/*</span>
    <span class="token comment">// - Reltaive: baz/**/*           -&gt; baz/**/*</span>
    <span class="token function">IsAbsolute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>

    <span class="token comment">// Root returns the root Cid of this selector.</span>
    <span class="token comment">// It may be nil if the selector is not absolute.</span>
    <span class="token function">Root</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Cid

    <span class="token comment">// Type returns the selector type code.</span>
    <span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> SelectorType

    <span class="token comment">// Bytes returns the binary packed serialized representation of this selector.</span>
    <span class="token comment">// Use this for all machine-oriented input/output (on the wire, disk, etc.)</span>
    <span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>

    <span class="token comment">// String returns the string serialized representation of this selector.</span>
    <span class="token comment">// Use this for all human readable input/output (terminal, etc).</span>
    <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// SelectorType is the enum used for selector type codes. These type codes</span>
<span class="token comment">// are part of the protocol and housed in the multicodec table.</span>
<span class="token keyword">type</span> SelectorType <span class="token builtin">int</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
    NullSelector SelectorType <span class="token operator">=</span> <span class="token number">0</span>
    CidSelector SelectorType <span class="token operator">=</span> <span class="token number">1</span>
    PathSelector SelectorType <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token comment">// Select is a function that applies a selector to a dag, returning the resulting</span>
<span class="token comment">// subdag. It is implemented using a Traverser. Given a lazy traverser</span>
<span class="token comment">// implementation, it should be a lazy application and avoid visiting the whole</span>
<span class="token comment">// dag until it needs to.</span>
<span class="token keyword">func</span> <span class="token function">Select</span><span class="token punctuation">(</span>d Dag<span class="token punctuation">,</span> s Selector<span class="token punctuation">)</span> Dag <span class="token punctuation">{</span>
    t <span class="token operator">:=</span> d<span class="token punctuation">.</span><span class="token function">Traverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>traversedDag<span class="token punctuation">{</span>d<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// traversedDag is a utility dag implementation that uses a traverser to</span>
<span class="token comment">// to apply a selector. this is what Select uses.</span>
<span class="token keyword">type</span> traversedDag <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    d Dag
    s Selector
    t Traverser
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>traversedDag<span class="token punctuation">)</span> <span class="token function">Root</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Node <span class="token punctuation">{</span>
    <span class="token keyword">if</span> d<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">IncludesPath</span><span class="token punctuation">(</span>RootPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> d<span class="token punctuation">.</span>d<span class="token punctuation">.</span><span class="token function">Root</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>traversedDag<span class="token punctuation">)</span> <span class="token function">GetNode</span><span class="token punctuation">(</span>path Path<span class="token punctuation">)</span> Node <span class="token punctuation">{</span>
    <span class="token keyword">if</span> d<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">IncludesPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> d<span class="token punctuation">.</span>d<span class="token punctuation">.</span><span class="token function">GetNode</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>traversedDag<span class="token punctuation">)</span> <span class="token function">Traverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Traverser <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">WrapTraverser</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>t<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipld/specs/edit/master/design/history/exploration-reports/2018.10-selectors.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/22/2021, 2:04:48 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.398f8b12.js" defer></script><script src="/assets/js/2.47786eef.js" defer></script><script src="/assets/js/54.73b115f3.js" defer></script>
  </body>
</html>
