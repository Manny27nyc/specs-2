<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IPLD Specifications</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Specifications for the Inter-planetary Linked Data project">
    
    <link rel="preload" href="/assets/css/0.styles.1c4fef16.css" as="style"><link rel="preload" href="/assets/js/app.3629e007.js" as="script"><link rel="preload" href="/assets/js/2.dee7ed4c.js" as="script"><link rel="preload" href="/assets/js/62.1a423254.js" as="script"><link rel="prefetch" href="/assets/js/10.b93170a5.js"><link rel="prefetch" href="/assets/js/11.9a3b470d.js"><link rel="prefetch" href="/assets/js/12.cdd7f2e5.js"><link rel="prefetch" href="/assets/js/13.f1c74105.js"><link rel="prefetch" href="/assets/js/14.5fba90d7.js"><link rel="prefetch" href="/assets/js/15.d075abad.js"><link rel="prefetch" href="/assets/js/16.0c2bf88b.js"><link rel="prefetch" href="/assets/js/17.c0445d96.js"><link rel="prefetch" href="/assets/js/18.e7ebfc2c.js"><link rel="prefetch" href="/assets/js/19.afec9d1c.js"><link rel="prefetch" href="/assets/js/20.7667865d.js"><link rel="prefetch" href="/assets/js/21.46ed4f1d.js"><link rel="prefetch" href="/assets/js/22.6c914b07.js"><link rel="prefetch" href="/assets/js/23.9ce655f6.js"><link rel="prefetch" href="/assets/js/24.d7fd2d2e.js"><link rel="prefetch" href="/assets/js/25.065c6d4e.js"><link rel="prefetch" href="/assets/js/26.df4fa512.js"><link rel="prefetch" href="/assets/js/27.48d1f812.js"><link rel="prefetch" href="/assets/js/28.7fba2ad3.js"><link rel="prefetch" href="/assets/js/29.d2954fe9.js"><link rel="prefetch" href="/assets/js/3.039f34ed.js"><link rel="prefetch" href="/assets/js/30.75e498cf.js"><link rel="prefetch" href="/assets/js/31.9e5b4c1e.js"><link rel="prefetch" href="/assets/js/32.4da5f3b8.js"><link rel="prefetch" href="/assets/js/33.4052b341.js"><link rel="prefetch" href="/assets/js/34.bd21d744.js"><link rel="prefetch" href="/assets/js/35.cabbe245.js"><link rel="prefetch" href="/assets/js/36.57f5dc15.js"><link rel="prefetch" href="/assets/js/37.0194e0b7.js"><link rel="prefetch" href="/assets/js/38.c6e889a7.js"><link rel="prefetch" href="/assets/js/39.6808d74e.js"><link rel="prefetch" href="/assets/js/4.fac9939a.js"><link rel="prefetch" href="/assets/js/40.81a3e1c1.js"><link rel="prefetch" href="/assets/js/41.07f98ace.js"><link rel="prefetch" href="/assets/js/42.b9b1fc27.js"><link rel="prefetch" href="/assets/js/43.339e3f8d.js"><link rel="prefetch" href="/assets/js/44.89c6200f.js"><link rel="prefetch" href="/assets/js/45.2e09e527.js"><link rel="prefetch" href="/assets/js/46.bd3e235b.js"><link rel="prefetch" href="/assets/js/47.0160ab07.js"><link rel="prefetch" href="/assets/js/48.1ed58eab.js"><link rel="prefetch" href="/assets/js/49.7d225384.js"><link rel="prefetch" href="/assets/js/5.5c92d69b.js"><link rel="prefetch" href="/assets/js/50.f57d497c.js"><link rel="prefetch" href="/assets/js/51.afed4385.js"><link rel="prefetch" href="/assets/js/52.08040c00.js"><link rel="prefetch" href="/assets/js/53.46db6a67.js"><link rel="prefetch" href="/assets/js/54.c6460908.js"><link rel="prefetch" href="/assets/js/55.13961a23.js"><link rel="prefetch" href="/assets/js/56.6848a552.js"><link rel="prefetch" href="/assets/js/57.be7ff850.js"><link rel="prefetch" href="/assets/js/58.f0743f1c.js"><link rel="prefetch" href="/assets/js/59.b1949fc2.js"><link rel="prefetch" href="/assets/js/6.7cf616ff.js"><link rel="prefetch" href="/assets/js/60.be5d6ff3.js"><link rel="prefetch" href="/assets/js/61.afeefe4d.js"><link rel="prefetch" href="/assets/js/63.e3e89c04.js"><link rel="prefetch" href="/assets/js/64.d22f94bb.js"><link rel="prefetch" href="/assets/js/65.e4ba1690.js"><link rel="prefetch" href="/assets/js/66.84525878.js"><link rel="prefetch" href="/assets/js/67.dfcf8d66.js"><link rel="prefetch" href="/assets/js/68.adf1720b.js"><link rel="prefetch" href="/assets/js/69.db09b6d2.js"><link rel="prefetch" href="/assets/js/7.a89a63cb.js"><link rel="prefetch" href="/assets/js/70.729b1b31.js"><link rel="prefetch" href="/assets/js/71.e810f6c3.js"><link rel="prefetch" href="/assets/js/72.9d3f942d.js"><link rel="prefetch" href="/assets/js/73.5f26241f.js"><link rel="prefetch" href="/assets/js/74.de610e17.js"><link rel="prefetch" href="/assets/js/75.822262d6.js"><link rel="prefetch" href="/assets/js/76.8a4ca9fd.js"><link rel="prefetch" href="/assets/js/77.c04a1a10.js"><link rel="prefetch" href="/assets/js/78.fd127fb7.js"><link rel="prefetch" href="/assets/js/79.76390086.js"><link rel="prefetch" href="/assets/js/8.aad8b89c.js"><link rel="prefetch" href="/assets/js/80.9907f42b.js"><link rel="prefetch" href="/assets/js/81.21b8960c.js"><link rel="prefetch" href="/assets/js/82.ceb7cc59.js"><link rel="prefetch" href="/assets/js/83.28615ea4.js"><link rel="prefetch" href="/assets/js/84.d159db8a.js"><link rel="prefetch" href="/assets/js/85.d6658ed7.js"><link rel="prefetch" href="/assets/js/86.b9154b99.js"><link rel="prefetch" href="/assets/js/87.73e80104.js"><link rel="prefetch" href="/assets/js/88.68b959e0.js"><link rel="prefetch" href="/assets/js/89.a907a876.js"><link rel="prefetch" href="/assets/js/9.13d8e553.js"><link rel="prefetch" href="/assets/js/90.4fddc516.js"><link rel="prefetch" href="/assets/js/91.761a8273.js"><link rel="prefetch" href="/assets/js/92.69361fef.js"><link rel="prefetch" href="/assets/js/93.cef894df.js"><link rel="prefetch" href="/assets/js/94.badda16d.js"><link rel="prefetch" href="/assets/js/95.81919550.js"><link rel="prefetch" href="/assets/js/96.16a93c57.js"><link rel="prefetch" href="/assets/js/97.3b54855e.js"><link rel="prefetch" href="/assets/js/98.a7e14ba9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c4fef16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">IPLD Specifications</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#_239-add-initial-specification-for-selector-syntax-closed" class="sidebar-link">#239: Add initial specification for selector syntax. (closed)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#files" class="sidebar-link">Files</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#motivation-what-is-selectors-syntax" class="sidebar-link">Motivation - What is Selectors Syntax</a></li></ul></li><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#examples" class="sidebar-link">Examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#deeply-nested-path" class="sidebar-link">Deeply Nested Path</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#getting-a-certain-number-of-parent-blocks-in-a-blockchain" class="sidebar-link">Getting a certain number of parent blocks in a blockchain</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#getting-changes-up-to-a-certain-one" class="sidebar-link">Getting changes up to a certain one</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#retrieving-data-recursively" class="sidebar-link">Retrieving data recursively</a></li></ul></li><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#syntax-specification" class="sidebar-link">Syntax Specification</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#long-and-short-keywords" class="sidebar-link">Long and Short Keywords</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#whitespace-is-ignored" class="sidebar-link">Whitespace is Ignored</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#parentheses-are-usually-optional" class="sidebar-link">Parentheses are Usually Optional</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#parameters-can-be-named" class="sidebar-link">Parameters can be Named</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#literal-values" class="sidebar-link">Literal Values</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#whitespace-and-comments" class="sidebar-link">Whitespace and Comments</a></li></ul></li><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#parser-specification" class="sidebar-link">Parser Specification</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#identifier-tokenization" class="sidebar-link">Identifier Tokenization</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#parentheses-and-parse-order" class="sidebar-link">Parentheses and Parse Order</a></li></ul></li><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#known-issues" class="sidebar-link">Known issues</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#other-related-work" class="sidebar-link">Other related work</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#implementations" class="sidebar-link">Implementations</a></li><li class="sidebar-sub-header"><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#design-history" class="sidebar-link">Design History</a></li></ul></li><li><a href="/design/history/exploration-reports/2020.02-selector-syntax.html#comments" class="sidebar-link">Comments</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="selector-syntax"><a href="#selector-syntax" class="header-anchor">#</a> Selector Syntax</h1> <p>This exploration report was originally <a href="https://github.com/ipld/specs/pull/239" target="_blank" rel="noopener noreferrer">Pull Requst 239<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It got converted <a href="https://github.com/vmx/export_issues" target="_blank" rel="noopener noreferrer">via script<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> into an exploration report in order to preserve all the useful information it contains.</p> <hr> <h2 id="_239-add-initial-specification-for-selector-syntax-closed"><a href="#_239-add-initial-specification-for-selector-syntax-closed" class="header-anchor">#</a> #239: Add initial specification for selector syntax. (closed)</h2> <p>Opened 2020-02-06T22:53:50Z by creationix, closed 2020-10-08T21:10:58Z</p> <p>This is a proposal for a selector syntax that closely models the semantics already in the IPLD format of selectors.  The rational and constraints for the design are included in the documents as well as many examples and hopefully enough description of lexing/parsing behavior to make it unambiguous.</p> <p>I would love feedback on what you like about this, what drives you crazy, and hopefully find out if this is a good direction.</p> <h2 id="files"><a href="#files" class="header-anchor">#</a> Files</h2> <p><code>selectors/selector-syntax.md</code></p> <h1 id="specification-ipld-selectors-syntax"><a href="#specification-ipld-selectors-syntax" class="header-anchor">#</a> Specification: IPLD Selectors Syntax</h1> <p><strong>Status: Prescriptive - Draft</strong></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <h3 id="motivation-what-is-selectors-syntax"><a href="#motivation-what-is-selectors-syntax" class="header-anchor">#</a> Motivation - What is Selectors Syntax</h3> <p>*Prerequisites: <a href="/design/history/exploration-reports/selectors.html">Selectors</a>.</p> <p>IPLD Selectors are represented as IPLD data nodes.  This is great for embedding them in a structured way, but authoring them or viewing them in this format isn't the easiest.  This syntax provides a textual DSL for reading/writing selectors in a more text friendly format.</p> <p>Tooling can be used to convert between formats and even various styles optimized for the use-case at hand.</p> <h4 id="url-friendly"><a href="#url-friendly" class="header-anchor">#</a> URL Friendly</h4> <p>Selector syntax should embed easily inside URLs.</p> <p>This means where possible, this syntax restricts itself to the characters that can be embedded in URLs without needing to escape them. This means this subset of ASCII:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span> <span class="token string">'!'</span><span class="token punctuation">,</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
  <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span>
  <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'J'</span><span class="token punctuation">,</span>
  <span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">,</span> <span class="token string">'Q'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span>
  <span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">,</span> <span class="token string">'W'</span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">,</span> <span class="token string">'Z'</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
  <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'h'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'j'</span><span class="token punctuation">,</span>
  <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">,</span>
  <span class="token string">'t'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">,</span> <span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'~'</span><span class="token punctuation">]</span>
</code></pre></div><blockquote><hr> <h4 id="_2020-02-08t18-07-01z-ribasushi"><a href="#_2020-02-08t18-07-01z-ribasushi" class="header-anchor">#</a> (2020-02-08T18:07:01Z) ribasushi:</h4> <p>&quot;Easy embedding inside URLs&quot; implies &quot;easy visual skimming&quot; ( perhaps with some initial training needed, just like e.g. regular expressions ). Assuming a person reading this is proficient: are we comfortable with a case sensitive, visually-collidable character set?</p> <p>I am not particularly leaning one way or the other, but rather am bringing the point up for discussion .</p> <hr> <h4 id="_2020-02-10t18-33-03z-creationix"><a href="#_2020-02-10t18-33-03z-creationix" class="header-anchor">#</a> (2020-02-10T18:33:03Z) creationix:</h4> <p>This is certainly something we can use as an added constraint to consider when choosing the characters used for short form.  Currently, it only uses <code>f</code>, <code>i</code>, <code>r</code>, <code>u</code>, <code>c</code>, <code>F</code>, <code>*</code>, <code>.</code>, and <code>~</code>.</p> <p>The listing of url safe characters is more of a technical constraint about what ASCII characters can be embedded in url components without needing to be escaped.</p></blockquote> <p>This also also means it needs to be as terse as possible and not contain whitespace of any kind.</p> <p>For example, this selector simulates a git shallow clone by recursively walking commit parents up to depth 5 and walking all of the tree graphs for each.</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code># Starting at the commit block.
R5f'tree'Rn*~'parents'*~
</code></pre></div><h4 id="human-friendly"><a href="#human-friendly" class="header-anchor">#</a> Human Friendly</h4> <p>Selector syntax should be easy to read/author by humans.</p> <p>This means it should be terser than the JSON or YAML representations of the IPLD data, but still verbose enough to have meaningful structure and keywords/symbols.</p> <blockquote><hr> <h4 id="_2020-03-02t03-49-28z-rvagg"><a href="#_2020-03-02t03-49-28z-rvagg" class="header-anchor">#</a> (2020-03-02T03:49:28Z) rvagg:</h4> <p>minor style suggestion: collapse these two paragraphs into a bullet-point list hanging off the first sentence:</p> <blockquote><p>... easy to read/author by humans. This means it should:</p> <ul><li>Be terser ...</li> <li>Allow flexibility ...</li></ul></blockquote></blockquote> <p>This means it should allow flexibility with whitespace as well as allowing optional symbols and annotations to make structure easier to see visually.</p> <p>The exact same selector for git shallow clone from above can also be written in the following style: (This is not another mode, it's the same syntax):</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code>recursive(limit=5
  fields(
    'tree'(
      recursive(limit=none
        all(recurse)
      )
    )
    'parents'(
      all(recurse)
    )
  )
)
</code></pre></div><h2 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h2> <h3 id="deeply-nested-path"><a href="#deeply-nested-path" class="header-anchor">#</a> Deeply Nested Path</h3> <p>Based on <a href="/design/history/exploration-reports/example-selectors.html#deeply-nested-path">this example</a>.</p> <p>A selector to extract the year:</p> <h4 id="human-readable-style"><a href="#human-readable-style" class="header-anchor">#</a> Human Readable Style</h4> <p>This is the default style for human interfacing.  It has clear structure and descriptive keywords.</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code>fields('characters'(
  fields('kathryn-janeway'(
    fields('birthday'(
      fields('year'(match))
    ))
  ))
))
</code></pre></div><h4 id="url-embeddable-style"><a href="#url-embeddable-style" class="header-anchor">#</a> URL Embeddable Style</h4> <p>This is the default style for maximum terseness.  It minifies everything possible.</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code>f'characters'f'kathryn-janeway'f'birthday'f'year'.
</code></pre></div><h3 id="getting-a-certain-number-of-parent-blocks-in-a-blockchain"><a href="#getting-a-certain-number-of-parent-blocks-in-a-blockchain" class="header-anchor">#</a> Getting a certain number of parent blocks in a blockchain</h3> <p>This is based on <a href="/design/history/exploration-reports/example-selectors.html#getting-a-certain-number-of-parent-blocks-in-a-blockchain">this sample</a>.</p> <h4 id="parents-without-recursion"><a href="#parents-without-recursion" class="header-anchor">#</a> Parents Without Recursion</h4> <p>Direct and simple path traversal:</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code># Long Form
fields('parent'(
  fields('parent'(
    fields('parent'(
      fields('parent'(
        fields('parent'(
          match
        ))
      ))
    ))
  ))
))

# Short Form
f'parent'f'parent'f'parent'f'parent'f'parent'.
</code></pre></div><h4 id="parents-using-recursion"><a href="#parents-using-recursion" class="header-anchor">#</a> Parents Using Recursion</h4> <div class="language-ipldsel extra-class"><pre class="language-text"><code># Long Form
recursive(limit=5
  fields('parent'(
    recurse
  ))
)

# Short Form
R5f'parent'~
</code></pre></div><h3 id="getting-changes-up-to-a-certain-one"><a href="#getting-changes-up-to-a-certain-one" class="header-anchor">#</a> Getting changes up to a certain one</h3> <p>Based on <a href="/design/history/exploration-reports/example-selectors.html#getting-changes-up-to-a-certain-one">this example</a>.</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code># Long Form
recursive(
  limit=100
  fields(
    'prev'(recurse)
  )
  stopAt=... # Conditions are not specified yet
)

# Short Form
R100f'prev'~... # Conditions are not specified yet
</code></pre></div><h3 id="retrieving-data-recursively"><a href="#retrieving-data-recursively" class="header-anchor">#</a> Retrieving data recursively</h3> <p>Based on <a href="/design/history/exploration-reports/example-selectors.html#retrieving-data-recursively">this example</a>.</p> <p>The following selector visits all <code>links</code> and matches all <code>data</code> fields:</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code># Long Form
recursive(limit=1000
  fields(
    'data'(match)
    'links'(
      all(
        fields('cid'(
          recurse
        ))
      )
    )
  )
)

# Short Form
R1000f'data'.'links'*f'cid'~
</code></pre></div><h2 id="syntax-specification"><a href="#syntax-specification" class="header-anchor">#</a> Syntax Specification</h2> <p>Selectors Syntax is defined as a textual projection of the Selector AST and thus does not contain any of its own runtime semantics.</p> <h3 id="long-and-short-keywords"><a href="#long-and-short-keywords" class="header-anchor">#</a> Long and Short Keywords</h3> <p>Each selector type has both long and short names that can be used interchangeably as follows:</p> <ul><li>Matcher can be <code>match</code> or <code>.</code></li> <li>ExploreAll can be <code>all</code> or <code>*</code></li> <li>ExploreFields can be <code>fields</code> or <code>f</code></li> <li>ExploreIndex can be <code>index</code> or <code>i</code></li> <li>ExploreRange can be <code>range</code> or <code>r</code></li> <li>ExploreRecursive can be <code>recursive</code> or <code>R</code></li> <li>ExploreUnion can be <code>union</code> or <code>u</code></li> <li>ExploreConditional can be <code>condition</code> or <code>c</code></li> <li>ExploreRecursiveEdge can be <code>recurse</code> or <code>~</code></li></ul> <p>This mode-less flexibility, combined with tools to automatically translate in bulk between styles, makes it possible for a single syntax to work well for both human and url embedding use cases.</p> <h3 id="whitespace-is-ignored"><a href="#whitespace-is-ignored" class="header-anchor">#</a> Whitespace is Ignored</h3> <p>Whitespace is completely ignored by the parser except for inside quoted strings.</p> <p>Line comments are also ignored even if they contain things that look like quoted strings</p> <h3 id="parentheses-are-usually-optional"><a href="#parentheses-are-usually-optional" class="header-anchor">#</a> Parentheses are Usually Optional</h3> <p>Parentheses annotate structure and are sometimes required for ambigious cases such as unions which contain an arbitrary number of selectors or selectors with optional parameters of conflicting types.</p> <p>For example <code>union(union match match)</code> is interpreted as <code>union(union(match match))</code> and not <code>union(union(match) match)</code> because in the first, the last match will be part of the inner union and not the outer union.  When minimizing, some parentheses might be kept to preserve semantics.</p> <ul><li><code>uu..</code> -&gt; <code>{ selector: { '|': [ { '|': [ { '.': {} }, { '.': {} } ] } ] } }</code></li> <li><code>uu(.).</code> -&gt; <code>{ selector: { '|': [ { '|': [ { '.': {} } ] }, { '.': {} } ] } }</code></li></ul> <p>The best practice (and what the default formatting styles will enforce) is for human readable selectors to use parentheses liberally while URL embedding style will only contain the required ones.</p> <blockquote><hr> <h4 id="_2020-02-08t18-23-01z-ribasushi"><a href="#_2020-02-08t18-23-01z-ribasushi" class="header-anchor">#</a> (2020-02-08T18:23:01Z) ribasushi:</h4> <p>I am not sure I fully understand this / the motivation for <code>R</code>...<code>~</code> and other scope-pairs is not entirely clear. Could you elaborate  &quot;even harder&quot; why you didn't go with a more traditional balanced pair of characters e.g. <code>(</code> <code>)</code> ? Especially jarring is the discrepancy of doing couple paragraphs down:</p> <div class="language- extra-class"><pre class="language-text"><code># URL Embeddable
R(5...)
</code></pre></div><hr> <h4 id="_2020-02-10t18-03-18z-creationix"><a href="#_2020-02-10t18-03-18z-creationix" class="header-anchor">#</a> (2020-02-10T18:03:18Z) creationix:</h4> <p>I'm not sure what you mean by pairing up <code>R</code> and <code>~</code>.  They are not necessarily balanced; there could technically be multiple recursive edges inside a single recursive node.  It's not a scope pair, but rather two distinct node types in the selector AST that happen to relate to eachother.</p> <p>Also I use <code>(</code> and <code>)</code> already in the syntax to help with forcing parameters to the correct nodes.</p> <hr> <h4 id="_2020-02-10t19-56-55z-ribasushi"><a href="#_2020-02-10t19-56-55z-ribasushi" class="header-anchor">#</a> (2020-02-10T19:56:55Z) ribasushi:</h4> <blockquote><p>They are not necessarily balanced; there could technically be multiple recursive edges inside a single recursive node.</p></blockquote> <p>This might <strong>very</strong> well be my lack of understanding of the problem domain. Let's cover this during the ipld meet if time permits.</p> <hr> <h4 id="_2020-02-10t21-58-24z-ribasushi"><a href="#_2020-02-10t21-58-24z-ribasushi" class="header-anchor">#</a> (2020-02-10T21:58:24Z) ribasushi:</h4> <p>We chatted about this a bit more - I now understand what was meant by the above quote. I withdraw the question about balanced parens 😉</p></blockquote> <h3 id="parameters-can-be-named"><a href="#parameters-can-be-named" class="header-anchor">#</a> Parameters can be Named</h3> <p>Parameters can usually be inferred by their contextual position, but there are some cases where it's ambigious and needs to be specified.  There are more cases where it's good to annotate them for human clarity.</p> <p>For example, <code>recursive</code> has two required parameters and a 3rd optional one.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">recursive</span><span class="token punctuation">(</span>sequence<span class="token operator">:</span> Selector<span class="token punctuation">,</span> limit<span class="token operator">:</span> int<span class="token punctuation">,</span> stopAt<span class="token operator">?</span><span class="token operator">:</span> Condition<span class="token punctuation">)</span>
</code></pre></div><p>Written verbosely with parentheses, named parameters, and whitespace, it looks like this:</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code>recursive(
    limit=5
    sequence=...
)
</code></pre></div><p>Depending on the context, we could omit the parentheses because the optional <code>stopAt</code> parameter is of type <code>Condition</code> and the parser likely expects something else after this node.</p> <blockquote><hr> <h4 id="_2020-03-02t04-26-59z-rvagg"><a href="#_2020-03-02t04-26-59z-rvagg" class="header-anchor">#</a> (2020-03-02T04:26:59Z) rvagg:</h4> <p>so there aren't any selector forms with possibly ambiguous lengths so predicting a <code>stopAt</code> in the shortened selector syntax should be straightforward?
I see <code>Matcher</code> in the selector schema also has two optional fields, <code>onlyIf</code> and <code>label</code>, could these get in the way?</p> <hr> <h4 id="_2020-03-08t03-02-04z-creationix"><a href="#_2020-03-08t03-02-04z-creationix" class="header-anchor">#</a> (2020-03-08T03:02:04Z) creationix:</h4> <p>It's hard to say.  This is why I'm implementing syntax parsers.  So far I've not come across any concrete use cases where the parentheses are actually needed.</p></blockquote> <p>Also we don't need to annotate <code>limit=</code> or <code>sequence=</code> since both are non-optional, and unique types.  Notice that the order doesn't matter and we can put <code>limit</code> before <code>sequence</code> because of unambigious types.</p> <p>Best practice is to annotate <code>limit</code>, but not <code>sequence</code> for human readable, and omit both for URL form.</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code># Human Readable
recursive(limit=5 ...)
# URL Embeddable
R5...
</code></pre></div><h3 id="literal-values"><a href="#literal-values" class="header-anchor">#</a> Literal Values</h3> <p>Some of the selectors accept literal values as parameters.  These are currently <code>String</code>, <code>{String:Selector}</code>, and <code>Int</code>.</p> <h4 id="integers"><a href="#integers" class="header-anchor">#</a> Integers</h4> <p>Integers can be encoded using base 10 with optional leadin sign:</p> <div class="language- extra-class"><pre class="language-text"><code>123 # Decimal
-123 # Negative decimal
</code></pre></div><h4 id="strings"><a href="#strings" class="header-anchor">#</a> Strings</h4> <p>Strings are quoted using single quote.  They can contain any characters including newlines and unicode characters.  The following characters can be escaped using backslash (<code>\</code>) followed by a special character.  If the backslash is followed by a character not in the list, it's considered a syntax error.</p> <ul><li>\b  Backspace (ascii code 08)</li> <li>\f  Form feed (ascii code 0C)</li> <li>\n  New line</li> <li>\r  Carriage return</li> <li>\t  Tab</li> <li>'  Single quote</li> <li>\  Backslash character</li></ul> <div class="language- extra-class"><pre class="language-text"><code>'Hello World'
'It\'s a lovely day'
'Multiline
strings'
'Multiline\nstrings'
</code></pre></div><h4 id="maps"><a href="#maps" class="header-anchor">#</a> Maps</h4> <p>We need to be able to encode the keys for the <code>fields</code> selector.  This is done using multiple string literals followed by nested contents.</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code>fields(
  'foo'(...)
  'bar'(...)
)
</code></pre></div><h3 id="whitespace-and-comments"><a href="#whitespace-and-comments" class="header-anchor">#</a> Whitespace and Comments</h3> <p>Comments are allowed in this syntax and will be preserved by auto-formatters when possible, but will be stripped when converting to URL style and are not included in the IPLD representation of the selector.</p> <p>A comment starts at <code>#</code> and ends at end of line.</p> <h2 id="parser-specification"><a href="#parser-specification" class="header-anchor">#</a> Parser Specification</h2> <h1 id="initial-stripping"><a href="#initial-stripping" class="header-anchor">#</a> Initial Stripping</h1> <p>The parser must act as is there was an initial pass that removed all whitespace not inside strings and all line comments.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># This is a comment 'this is not a string'</span>
'This <span class="token comment"># is # a string' this is normal</span>
this is also normal

<span class="token comment"># Keywords get merged</span>
hello world
helloworld

<span class="token comment"># Comments get stripped</span>
'a <span class="token keyword">string</span>' <span class="token comment"># and comment</span>
'a <span class="token keyword">string</span>'

<span class="token comment"># Strings inside comments are still comments</span>
empty <span class="token comment"># a comment with a 'string'</span>
empty
</code></pre></div><h3 id="identifier-tokenization"><a href="#identifier-tokenization" class="header-anchor">#</a> Identifier Tokenization</h3> <p>The parser knows a fixed set of built-ins to look for.  This is the long and short forms of the selectors and other built-ins.  To keep the specification simple, text is semantically tokenized by sorting all the identifiers longest first and trying each one in that order till one matches.</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code># This will match `fields` first and not even try `f`.
fields...
</code></pre></div><h3 id="parentheses-and-parse-order"><a href="#parentheses-and-parse-order" class="header-anchor">#</a> Parentheses and Parse Order</h3> <p>Arguments/parameters are consumed greedily by the innermost consumer.  If the type doesn't match what it is looking for, then it is closed and the next in the stack gets a shot.  If we run out of consumers and the value is unmatched, it's a syntax error.  For example:</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code>fields 'fieldName' match
</code></pre></div><p>First we parse <code>fields</code>. This expects <code>{String:Selector}</code>, which to the parser, is a stream of alternating <code>String</code> and <code>Selector</code> tokens.  We put this on the stack and look at the next value.  It's a <code>String</code> which has no children.  The consumer on the top of the stack is looking for a string, so we give it to it.  Then we read the next.  It's a <code>match</code> which also has no children.  The <code>fields</code> on the stack is now looking for a <code>Selector</code> which this qualifies as, so it gets consumed next.</p> <p>After that we reach the end of the stream and pop everything off the stack.  Any consumer that still lacks a required parameter is now a syntax error.</p> <p>We could have added parentheses to this, but they were not needed since the default parsing interpretation is what we wanted.</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code># This is the same as above when parsed.
fields('fieldname'(match))
</code></pre></div><p>When parentheses are added, they can override the default greedy behavior in some otherwise ambigious cases.  Again, the example <code>union union match match</code> is not <code>union(union(match) match)</code> but is <code>union(union(match match))</code> because the innermost union gets to greedily match first.  Extra parentheses can be added as <code>union union(match) match)</code>, or in short form<code>uu(.).</code> vs <code>uu..</code></p> <h2 id="known-issues"><a href="#known-issues" class="header-anchor">#</a> Known issues</h2> <ul><li>Note that the status of this document is &quot;Draft&quot;!</li> <li>The &quot;Condition&quot; system is not fully specified -- it is a placeholder awaiting further design.</li> <li>The description of the lexing and parsing algorithm should be sufficient for unambiguous parsing, but more formal consideration is strongly recommended including tools to test for regressions as we add to this language.</li></ul> <h2 id="other-related-work"><a href="#other-related-work" class="header-anchor">#</a> Other related work</h2> <h3 id="implementations"><a href="#implementations" class="header-anchor">#</a> Implementations</h3> <p>None yet.</p> <h3 id="design-history"><a href="#design-history" class="header-anchor">#</a> Design History</h3> <p>None yet.</p> <hr> <h2 id="comments"><a href="#comments" class="header-anchor">#</a> Comments</h2> <h4 id="_2020-02-07t17-01-27z-vmx"><a href="#_2020-02-07t17-01-27z-vmx" class="header-anchor">#</a> (2020-02-07T17:01:27Z) vmx:</h4> <p>Wow, that is really a good read. My comments are only in regards to typos the rest sounds great.</p> <hr> <h4 id="_2020-02-08t18-24-18z-ribasushi"><a href="#_2020-02-08t18-24-18z-ribasushi" class="header-anchor">#</a> (2020-02-08T18:24:18Z) ribasushi:</h4> <p>Marking &quot;request changes&quot; as stand-in for &quot;request discussion&quot;. Will d another pass over this once the first two pieces are clarified</p> <p>Awesome work as a whole!</p> <hr> <h4 id="_2020-02-08t18-29-40z-warpfork"><a href="#_2020-02-08t18-29-40z-warpfork" class="header-anchor">#</a> (2020-02-08T18:29:40Z) warpfork:</h4> <p>I have no objections to this, I think 😃</p> <p>I'm also not really reviewing for ergonomics though, as I feel ill suited to do so without an application in my mind's eye, which I'm pretty sparse on.  And thus, &quot;no objections&quot; is about the greenest light I'm likely to give, if that makes sense. 😛</p> <hr> <h4 id="_2020-02-10t18-43-57z-creationix"><a href="#_2020-02-10t18-43-57z-creationix" class="header-anchor">#</a> (2020-02-10T18:43:57Z) creationix:</h4> <p>After spending a day implementing a full parser, I've discovered the white-space rules are more interesting than I initially thought.  The design goal was to make white-space 100% irrelevant to the parser.  Most programming languages claim to not have significant white-space, but that's not entirely true for any real language.</p> <p>The first exception obviously is white-space within strings needs to be preserved.  This is easy enough, I simply turn off white-space stripping when within quoted sections.</p> <p>The second case is one you typically don't realize.  Most languages use white-space as token separators.  For example:</p> <div class="language- extra-class"><pre class="language-text"><code># Escaped quotes
'This is ''one'' string with escaped quotes.'
# Escaped quotes or two strings?
'is this one string?' 'or two strings?`
</code></pre></div><p>The parsing of the second example <em>depends</em> on that space being between the two string literals.  If we really ignore white-space, then it should parse the same if the space is removed.</p> <p>Currently, this syntax really means it when it says no white-space, and the second will be a single string.</p> <p>Another example is identifiers.  In most languages <code>foo bar</code> is clearly two identifiers while <code>foobar</code> is one.  In this language, we ignore the space entirely and both look identical to the parser. It needs other clues to know where one identifier/selector starts and where another ends.  This is accomplished by the language having a fixed set of identifiers and careful design to make sure that there is never ambiguity.</p> <p>For example we should avoid having a <code>foo</code> selector with short form <code>f</code> if there is also another selector who's short form is <code>o</code>.  A developer may write <code>foo</code> and we might interpret it as <code>f</code>, <code>o</code>, <code>o</code>, or they might write <code>f o o</code> and we interpret it as <code>foo</code>.</p> <p>This spec does specify which it should be (it would be always <code>foo</code> because it's longer).  But we also want to avoid these situations whenever possible since humans are not compilers and may have different expectations since most/all existing languages don't really ignore white-space.</p> <hr> <h4 id="_2020-02-10t21-43-53z-creationix"><a href="#_2020-02-10t21-43-53z-creationix" class="header-anchor">#</a> (2020-02-10T21:43:53Z) creationix:</h4> <p>@warpfork One solution to the potential confusion with merged identifiers would be to preserve the white-space as tokens and tell the parser about them.  But the problem with this is it would require those spaces to be preserved in compact mode.  This could almost double the length of minimized version and include lots of spaces which can sometimes be problematic in URLs.</p> <p>I'll consider it further though.</p> <hr> <h4 id="_2020-02-10t22-10-48z-warpfork"><a href="#_2020-02-10t22-10-48z-warpfork" class="header-anchor">#</a> (2020-02-10T22:10:48Z) warpfork:</h4> <p>Definitely meant my remark on that as a &quot;2 cents&quot;.  You've probably already thought about it much more than I have.</p> <hr> <h4 id="_2020-02-17t22-46-15z-creationix"><a href="#_2020-02-17t22-46-15z-creationix" class="header-anchor">#</a> (2020-02-17T22:46:15Z) creationix:</h4> <p>The initial lexer implementation is now done.  The description in the spec for parsing out identifiers seems to be working. https://github.com/creationix/sel-parse-zig/blob/887c3628e11b4ff751e68a9ade4c18a9bf4daf25/src/lexer.zig</p> <p>In particular, there is a hard coded list of identifiers expected here:</p> <div class="language-zig extra-class"><pre class="language-zig"><code><span class="token comment">// Sorted by longest first, then lexical within same length.</span>
<span class="token keyword">const</span> identifiers <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">{</span>
<span class="token string">&quot;condition&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;recursive&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;recurse&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;fields&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;match&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;range&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;union&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;~&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;R&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;u&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>And then parsing those ends up being quite straightforward.</p> <div class="language-zig extra-class"><pre class="language-zig"><code><span class="token comment">// Tokenize Identifiers</span>
<span class="token keyword">inline</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>identifiers<span class="token punctuation">)</span> <span class="token operator">|</span>ident<span class="token operator">|</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> matched <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-types keyword">u32</span></span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> ident<span class="token punctuation">.</span>len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> input<span class="token punctuation">.</span>len <span class="token keyword">or</span> ident<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
matched <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>matched<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token class-name">Token</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token punctuation">.</span>Identifier<span class="token punctuation">,</span> <span class="token punctuation">.</span>slice <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">..</span>i<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h4 id="_2020-02-17t23-08-55z-creationix"><a href="#_2020-02-17t23-08-55z-creationix" class="header-anchor">#</a> (2020-02-17T23:08:55Z) creationix:</h4> <p>To get an idea of what the lexer tokens look like, this is the output of the following:</p> <div class="language-ipldsel extra-class"><pre class="language-text"><code>recursive(limit=5
fields(
'tree'(
recursive(
all(recurse)
)
)
'parents'(
all(recurse)
)
)
)
</code></pre></div><div class="language-zig extra-class"><pre class="language-zig"><code><span class="token number">0</span>       Id<span class="token punctuation">.</span>Identifier   9B      `recursive`
<span class="token number">9</span>       Id<span class="token punctuation">.</span>Open 1B      `<span class="token punctuation">(</span>`
<span class="token number">10</span>      Id<span class="token punctuation">.</span>Unknown      1B      `l`
<span class="token number">11</span>      Id<span class="token punctuation">.</span>Identifier   1B      `i`
<span class="token number">12</span>      Id<span class="token punctuation">.</span>Unknown      1B      `m`
<span class="token number">13</span>      Id<span class="token punctuation">.</span>Identifier   1B      `i`
<span class="token number">14</span>      Id<span class="token punctuation">.</span>Unknown      2B      `t<span class="token operator">=</span>`
<span class="token number">16</span>      Id<span class="token punctuation">.</span>Decimal      1B      `<span class="token number">5</span>`
<span class="token number">17</span>      Id<span class="token punctuation">.</span>Whitespace   3B      `
`
<span class="token number">20</span>      Id<span class="token punctuation">.</span>Identifier   6B      `fields`
<span class="token number">26</span>      Id<span class="token punctuation">.</span>Open 1B      `<span class="token punctuation">(</span>`
<span class="token number">27</span>      Id<span class="token punctuation">.</span>Whitespace   5B      `
`
<span class="token number">32</span>      Id<span class="token punctuation">.</span>String       6B      `'tree'`
<span class="token number">38</span>      Id<span class="token punctuation">.</span>Open 1B      `<span class="token punctuation">(</span>`
<span class="token number">39</span>      Id<span class="token punctuation">.</span>Whitespace   7B      `
`
<span class="token number">46</span>      Id<span class="token punctuation">.</span>Identifier   9B      `recursive`
<span class="token number">55</span>      Id<span class="token punctuation">.</span>Open 1B      `<span class="token punctuation">(</span>`
<span class="token number">56</span>      Id<span class="token punctuation">.</span>Whitespace   9B      `
`
<span class="token number">65</span>      Id<span class="token punctuation">.</span>Identifier   3B      `all`
<span class="token number">68</span>      Id<span class="token punctuation">.</span>Open 1B      `<span class="token punctuation">(</span>`
<span class="token number">69</span>      Id<span class="token punctuation">.</span>Identifier   7B      `recurse`
<span class="token number">76</span>      Id<span class="token punctuation">.</span>Close        1B      `<span class="token punctuation">)</span>`
<span class="token number">77</span>      Id<span class="token punctuation">.</span>Whitespace   7B      `
`
<span class="token number">84</span>      Id<span class="token punctuation">.</span>Close        1B      `<span class="token punctuation">)</span>`
<span class="token number">85</span>      Id<span class="token punctuation">.</span>Whitespace   5B      `
`
<span class="token number">90</span>      Id<span class="token punctuation">.</span>Close        1B      `<span class="token punctuation">)</span>`
<span class="token number">91</span>      Id<span class="token punctuation">.</span>Whitespace   5B      `
`
<span class="token number">96</span>      Id<span class="token punctuation">.</span>String       9B      `'parents'`
<span class="token number">105</span>     Id<span class="token punctuation">.</span>Open 1B      `<span class="token punctuation">(</span>`
<span class="token number">106</span>     Id<span class="token punctuation">.</span>Whitespace   7B      `
`
<span class="token number">113</span>     Id<span class="token punctuation">.</span>Identifier   3B      `all`
<span class="token number">116</span>     Id<span class="token punctuation">.</span>Open 1B      `<span class="token punctuation">(</span>`
<span class="token number">117</span>     Id<span class="token punctuation">.</span>Identifier   7B      `recurse`
<span class="token number">124</span>     Id<span class="token punctuation">.</span>Close        1B      `<span class="token punctuation">)</span>`
<span class="token number">125</span>     Id<span class="token punctuation">.</span>Whitespace   5B      `
`
<span class="token number">130</span>     Id<span class="token punctuation">.</span>Close        1B      `<span class="token punctuation">)</span>`
<span class="token number">131</span>     Id<span class="token punctuation">.</span>Whitespace   3B      `
`
<span class="token number">134</span>     Id<span class="token punctuation">.</span>Close        1B      `<span class="token punctuation">)</span>`
<span class="token number">135</span>     Id<span class="token punctuation">.</span>Whitespace   1B      `
`
<span class="token number">136</span>     Id<span class="token punctuation">.</span>Close        1B      `<span class="token punctuation">)</span>`
</code></pre></div><hr> <h4 id="_2020-03-02t04-54-53z-rvagg"><a href="#_2020-03-02t04-54-53z-rvagg" class="header-anchor">#</a> (2020-03-02T04:54:53Z) rvagg:</h4> <p>I really like how the two forms are really just one form, with shortenings (and no comments for URL form), but we're trading that against ease of implementation though, so every environment that needs to be able to use these would need to have a custom parser written. I doesn't <em>seem</em> difficult, but it's worth noting as we expand our language support (Go, JS and now Rust, but also Filecoin is using selectors and being implemented in C++ and maybe others too and this might be something they want at some point) that we're making that exchange.</p> <hr> <h4 id="_2020-03-08t03-07-16z-creationix"><a href="#_2020-03-08t03-07-16z-creationix" class="header-anchor">#</a> (2020-03-08T03:07:16Z) creationix:</h4> <p>@rvagg FWIW, I'm working on two concurrent implementations.  One in vanilla JS and one using zig-lang which can be compiled to webassembly or a C ABI library for use in virtually any language.  I plan to tweaking this spec with my findings from the two parsers to ensure it's not more difficult than it needs to be.</p> <hr> <h4 id="_2020-03-14t16-23-40z-creationix"><a href="#_2020-03-14t16-23-40z-creationix" class="header-anchor">#</a> (2020-03-14T16:23:40Z) creationix:</h4> <p>So while implementing multiple versions of the parser, I'm getting more and more convinced this spec needs to be more automated and formalized.  I'm now spiking on generating a syntax grammer that can be automatically derived from the selector schema directly.  The design will still be similar to what's proposed here, but it should be more consistent and less hand-crafted to make tooling across the board easier.</p> <hr> <h4 id="_2020-03-16t14-23-39z-creationix"><a href="#_2020-03-16t14-23-39z-creationix" class="header-anchor">#</a> (2020-03-16T14:23:39Z) creationix:</h4> <p>Ok, the JS parser can now correctly compile all the sample selectors in this spec.  The new approach worked well.  Basically, I load the existing IPLD Schema for selectors and generate a parser from that.  In order to match the proposed syntax, the parser generator accepts a list of &quot;aliases&quot; for various types.  For example, this is the line in JS that generates the selector syntax parser:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token function">schemaParse</span><span class="token punctuation">(</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/selectors.ipldsch</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> parseSelectorEnvelope <span class="token operator">=</span> <span class="token function">makeParser</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> <span class="token string">&quot;SelectorEnvelope&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
Matcher<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'match'</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
ExploreAll<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
ExploreFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'fields'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
ExploreIndex<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
ExploreRange<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'range'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
ExploreRecursive<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'recursive'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
ExploreUnion<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'union'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
ExploreConditional<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'condition'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
ExploreRecursiveEdge<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'recurse'</span><span class="token punctuation">,</span> <span class="token string">'~'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
RecursionLimit_None<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'none'</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The types mentioned are existing in the schema, I'm creating a semi-automated DSL by specifying the entry point and long and short keywords for some types.</p> <p>Note that this library could be used to create a DSL for <em>any</em> IPLD data structure that has a schema.</p> <hr> <h4 id="_2020-03-16t15-10-36z-creationix"><a href="#_2020-03-16t15-10-36z-creationix" class="header-anchor">#</a> (2020-03-16T15:10:36Z) creationix:</h4> <p>I found a case where the parentheses are significant and can't always be removed when converting to short form.  Consider the following selector:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>union<span class="token punctuation">(</span>
union<span class="token punctuation">(</span>
match
<span class="token punctuation">)</span>
match
<span class="token punctuation">)</span>
</code></pre></div><p>Since<code>union</code> (aka  <code>ExploreUnion</code>) contains a list (aka <code>[Selector]</code>), it consumes an arbitrary number of selectors.  If the parentheses are removed, the two matches will be put under the inner union.  Therefore the short form of this is:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Correct short form</span>
uu<span class="token punctuation">(</span>.<span class="token punctuation">)</span>.

<span class="token comment"># Wrong short form</span>
uu<span class="token punctuation">..</span>
</code></pre></div><p>We could keep it simple and say the minimizer always preserves parentheses when encoding a list.  I don't even know of any real world use cases that use <code>ExploreUnion</code> and would love to see the actual use cases.  A smarter minimizer could do some basic analysis to know when the parentheses are required and only include them then.</p> <hr> <h4 id="_2020-03-16t15-21-19z-creationix"><a href="#_2020-03-16t15-21-19z-creationix" class="header-anchor">#</a> (2020-03-16T15:21:19Z) creationix:</h4> <p>Another case where they are required is labeled matchers inside of fields.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Fields with labels</span>
fields<span class="token punctuation">(</span>
<span class="token string">'with-label'</span><span class="token punctuation">(</span>
match<span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token string">'without-label'</span><span class="token punctuation">(</span>
match
<span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment"># Properly Minimized</span>
f<span class="token string">'with-label'</span><span class="token punctuation">(</span>.<span class="token string">'label'</span><span class="token punctuation">)</span><span class="token string">'without-label'</span><span class="token builtin class-name">.</span>

<span class="token comment"># Another Properly Minimized</span>
f<span class="token string">'with-label'</span>.<span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">)</span><span class="token string">'without-label'</span><span class="token builtin class-name">.</span>

<span class="token comment"># Broken minimized</span>
f<span class="token string">'with-label'</span><span class="token builtin class-name">.</span><span class="token string">'label'</span>'without-label'.
</code></pre></div><p>This brings up another question about normalization of minimized form.  Are we OK with there being multiple correct short forms?  Does it matter?</p> <hr> <h4 id="_2020-03-16t15-59-25z-creationix"><a href="#_2020-03-16t15-59-25z-creationix" class="header-anchor">#</a> (2020-03-16T15:59:25Z) creationix:</h4> <p>@rvagg, you were right!</p> <p>Strings are problematic too.  The less common escaping method used for strings (two single quotes) works, but it also introduces cases where multiple token are merged.  For example, consider the following:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>fields
<span class="token string">'foo'</span>
match
<span class="token assign-left variable">label</span><span class="token operator">=</span><span class="token string">'blue'</span>
<span class="token string">'bar'</span>
match
</code></pre></div><p>This currently breaks because the <code>'blue'</code> label and the <code>'bar'</code> field are merged into a single label containing <code>&quot;blue'bar&quot;</code>.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>Sample:

fields
<span class="token string">'with-label'</span>
match
<span class="token assign-left variable">label</span><span class="token operator">=</span><span class="token string">'my-label'</span>
<span class="token string">'another-field'</span>
match


SyntaxError: <span class="token string">&quot;fields'foo'matchlabel='blue''bar'match&quot;</span>
^ Unexpected extra syntax at <span class="token number">33</span>
</code></pre></div><p>I propose we switch to a more traditional string syntax with backslash escaping.  It will add some bloat when url encoding, but overall should be an improvement.</p> <hr> <h4 id="_2020-03-17t06-15-41z-rvagg"><a href="#_2020-03-17t06-15-41z-rvagg" class="header-anchor">#</a> (2020-03-17T06:15:41Z) rvagg:</h4> <blockquote><p>This brings up another question about normalization of minimized form. Are we OK with there being multiple correct short forms? Does it matter?</p></blockquote> <p>I don't know specifically for this but we keep on finding cases elsewhere where we don't have one-single-way and this being a problem. I don't know how that would show up here, but maybe if someone chose to encode a selector string rather than a full selector as per schema then having more than one way to say the same thing might be a problem. There's a lot of byte-shavers around that will look at this work and look at the full selector schema and opt for a short string form.</p> <p>Would it be a big deal to make a <em>must be simplest accurate representation</em> rule that would give us one-single-way?</p> <p>Re <code>ExploreUnion</code>, it's a selection strategy that is only useful when you have more than one selector to use isn't it? For practical purposes you should always have &gt;1 item in the list, making parens always necessary and your example overly simple. There are going to be cases of poorly crafted selectors that misuse it, but that shouldn't be the normal case.</p> <hr> <h4 id="_2020-10-08t21-10-58z-mikeal"><a href="#_2020-10-08t21-10-58z-mikeal" class="header-anchor">#</a> (2020-10-08T21:10:58Z) mikeal:</h4> <p>We’ve learned a lot from this but we’re not quite sure how we want to handle simplified string representations for selectors and paths. Closing for now.</p> <hr> <h4 id="_2020-10-08t21-10-58z-closed-by-mikeal"><a href="#_2020-10-08t21-10-58z-closed-by-mikeal" class="header-anchor">#</a> (2020-10-08T21:10:58Z) Closed by mikeal</h4></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipld/specs/edit/master/design/history/exploration-reports/2020.02-selector-syntax.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/11/2021, 12:06:37 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3629e007.js" defer></script><script src="/assets/js/2.dee7ed4c.js" defer></script><script src="/assets/js/62.1a423254.js" defer></script>
  </body>
</html>
