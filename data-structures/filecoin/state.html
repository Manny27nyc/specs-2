<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Filecoin Actor State Data Structures | IPLD Specifications</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Specifications for the Inter-planetary Linked Data project">
    
    <link rel="preload" href="/assets/css/0.styles.efbc2944.css" as="style"><link rel="preload" href="/assets/js/app.322f50e4.js" as="script"><link rel="preload" href="/assets/js/2.c9aef7ee.js" as="script"><link rel="preload" href="/assets/js/35.3d9e8823.js" as="script"><link rel="prefetch" href="/assets/js/10.80b48b37.js"><link rel="prefetch" href="/assets/js/11.1641c020.js"><link rel="prefetch" href="/assets/js/12.1b3d1126.js"><link rel="prefetch" href="/assets/js/13.da411957.js"><link rel="prefetch" href="/assets/js/14.e94d059e.js"><link rel="prefetch" href="/assets/js/15.bc54677d.js"><link rel="prefetch" href="/assets/js/16.bb54ce23.js"><link rel="prefetch" href="/assets/js/17.e7c8dca4.js"><link rel="prefetch" href="/assets/js/18.bacd0489.js"><link rel="prefetch" href="/assets/js/19.7cfabab8.js"><link rel="prefetch" href="/assets/js/20.340df871.js"><link rel="prefetch" href="/assets/js/21.12c49b2f.js"><link rel="prefetch" href="/assets/js/22.4f69bd1a.js"><link rel="prefetch" href="/assets/js/23.791353bb.js"><link rel="prefetch" href="/assets/js/24.9e342dba.js"><link rel="prefetch" href="/assets/js/25.f3290d60.js"><link rel="prefetch" href="/assets/js/26.72c9f531.js"><link rel="prefetch" href="/assets/js/27.6a1cd32b.js"><link rel="prefetch" href="/assets/js/28.4de94617.js"><link rel="prefetch" href="/assets/js/29.1bc51d0d.js"><link rel="prefetch" href="/assets/js/3.35e7958c.js"><link rel="prefetch" href="/assets/js/30.f6f9f577.js"><link rel="prefetch" href="/assets/js/31.8090138c.js"><link rel="prefetch" href="/assets/js/32.38d4d9f2.js"><link rel="prefetch" href="/assets/js/33.2d3f0420.js"><link rel="prefetch" href="/assets/js/34.a01d8110.js"><link rel="prefetch" href="/assets/js/36.6fd4e350.js"><link rel="prefetch" href="/assets/js/37.c14f51fc.js"><link rel="prefetch" href="/assets/js/38.6fdba428.js"><link rel="prefetch" href="/assets/js/39.43f54ccc.js"><link rel="prefetch" href="/assets/js/4.6d11ece8.js"><link rel="prefetch" href="/assets/js/40.bdbe0c51.js"><link rel="prefetch" href="/assets/js/41.76aedffd.js"><link rel="prefetch" href="/assets/js/42.ec44d550.js"><link rel="prefetch" href="/assets/js/43.b599aa41.js"><link rel="prefetch" href="/assets/js/44.8fcabd1b.js"><link rel="prefetch" href="/assets/js/45.21b1e9e6.js"><link rel="prefetch" href="/assets/js/46.f67653dd.js"><link rel="prefetch" href="/assets/js/47.90c2e517.js"><link rel="prefetch" href="/assets/js/48.08c71497.js"><link rel="prefetch" href="/assets/js/49.b2452e28.js"><link rel="prefetch" href="/assets/js/5.0916d921.js"><link rel="prefetch" href="/assets/js/50.07c2d840.js"><link rel="prefetch" href="/assets/js/51.a73261f2.js"><link rel="prefetch" href="/assets/js/52.aadcd441.js"><link rel="prefetch" href="/assets/js/53.c45d87dd.js"><link rel="prefetch" href="/assets/js/54.2b1a8428.js"><link rel="prefetch" href="/assets/js/55.17137af2.js"><link rel="prefetch" href="/assets/js/56.70524c2c.js"><link rel="prefetch" href="/assets/js/57.30f741e2.js"><link rel="prefetch" href="/assets/js/58.0c572c48.js"><link rel="prefetch" href="/assets/js/59.0cb5f1f4.js"><link rel="prefetch" href="/assets/js/6.ca92220f.js"><link rel="prefetch" href="/assets/js/60.9a3848dd.js"><link rel="prefetch" href="/assets/js/61.2a89f77d.js"><link rel="prefetch" href="/assets/js/62.ae35ce46.js"><link rel="prefetch" href="/assets/js/63.02fcc34d.js"><link rel="prefetch" href="/assets/js/64.d51b9213.js"><link rel="prefetch" href="/assets/js/65.fafb226c.js"><link rel="prefetch" href="/assets/js/66.2ddc27b3.js"><link rel="prefetch" href="/assets/js/67.f2814017.js"><link rel="prefetch" href="/assets/js/68.b958dd98.js"><link rel="prefetch" href="/assets/js/69.76707077.js"><link rel="prefetch" href="/assets/js/7.04b27c4a.js"><link rel="prefetch" href="/assets/js/70.7141b06b.js"><link rel="prefetch" href="/assets/js/71.5934ea67.js"><link rel="prefetch" href="/assets/js/72.a266e497.js"><link rel="prefetch" href="/assets/js/73.0f2c564f.js"><link rel="prefetch" href="/assets/js/74.b347f3cf.js"><link rel="prefetch" href="/assets/js/75.e2050c31.js"><link rel="prefetch" href="/assets/js/76.d8342fc0.js"><link rel="prefetch" href="/assets/js/77.ed687d67.js"><link rel="prefetch" href="/assets/js/78.7071b2fc.js"><link rel="prefetch" href="/assets/js/79.940a9e33.js"><link rel="prefetch" href="/assets/js/8.d433fc94.js"><link rel="prefetch" href="/assets/js/80.74fe820f.js"><link rel="prefetch" href="/assets/js/81.82dcc21d.js"><link rel="prefetch" href="/assets/js/82.841b7485.js"><link rel="prefetch" href="/assets/js/83.c42acedf.js"><link rel="prefetch" href="/assets/js/84.d9569090.js"><link rel="prefetch" href="/assets/js/85.1cbc1df1.js"><link rel="prefetch" href="/assets/js/86.12ef2d95.js"><link rel="prefetch" href="/assets/js/87.a64b4d1d.js"><link rel="prefetch" href="/assets/js/88.769c7996.js"><link rel="prefetch" href="/assets/js/89.e860f2e9.js"><link rel="prefetch" href="/assets/js/9.dfaf9f99.js"><link rel="prefetch" href="/assets/js/90.eae92072.js"><link rel="prefetch" href="/assets/js/91.c6fb5a86.js"><link rel="prefetch" href="/assets/js/92.1c0d5c11.js"><link rel="prefetch" href="/assets/js/93.f7c4e9c0.js"><link rel="prefetch" href="/assets/js/94.d865060f.js"><link rel="prefetch" href="/assets/js/95.ed0bb3e7.js"><link rel="prefetch" href="/assets/js/96.729b3918.js">
    <link rel="stylesheet" href="/assets/css/0.styles.efbc2944.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">IPLD Specifications</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/schemas/" class="nav-link">
  IPLD Schemas
</a></div> <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Filecoin Actor State Data Structures</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/data-structures/filecoin/state.html#initactor" class="sidebar-link">InitActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#cronactor" class="sidebar-link">CronActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-2" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-2" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#rewardactor" class="sidebar-link">RewardActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-3" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-3" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#accountactor" class="sidebar-link">AccountActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-4" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-4" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#storagemarketactor" class="sidebar-link">StorageMarketActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-5" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-5" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#storagemineractor" class="sidebar-link">StorageMinerActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-6" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-6" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#multisigactor" class="sidebar-link">MultisigActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-7" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-7" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#paymentchannelactor" class="sidebar-link">PaymentChannelActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-8" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-8" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#storagepoweractor" class="sidebar-link">StoragePowerActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-9" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-9" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#verifiedregistryactor" class="sidebar-link">VerifiedRegistryActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-10" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-10" class="sidebar-link">v2</a></li></ul></li><li><a href="/data-structures/filecoin/state.html#systemactor" class="sidebar-link">SystemActor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v0-11" class="sidebar-link">v0</a></li><li class="sidebar-sub-header"><a href="/data-structures/filecoin/state.html#v2-11" class="sidebar-link">v2</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="filecoin-actor-state-data-structures"><a href="#filecoin-actor-state-data-structures" class="header-anchor">#</a> Filecoin Actor State Data Structures</h1> <ul><li><a href="#initactor">InitActor</a> <ul><li><a href="#v0">v0</a></li> <li><a href="#v2">v2</a></li></ul></li> <li><a href="#cronactor">CronActor</a> <ul><li><a href="#v0-1">v0</a></li> <li><a href="#v2-1">v2</a></li></ul></li> <li><a href="#rewardactor">RewardActor</a> <ul><li><a href="#v0-2">v0</a></li> <li><a href="#v2-2">v2</a></li></ul></li> <li><a href="#accountactor">AccountActor</a> <ul><li><a href="#v0-3">v0</a></li> <li><a href="#v2-3">v2</a></li></ul></li> <li><a href="#storagemarketactor">StorageMarketActor</a> <ul><li><a href="#v0-4">v0</a></li> <li><a href="#v2-4">v2</a></li></ul></li> <li><a href="#storagemineractor">StorageMinerActor</a> <ul><li><a href="#v0-5">v0</a></li> <li><a href="#v2-5">v2</a></li></ul></li> <li><a href="#multisigactor">MultisigActor</a> <ul><li><a href="#v0-6">v0</a></li> <li><a href="#v2-6">v2</a></li></ul></li> <li><a href="#paymentchannelactor">PaymentChannelActor</a> <ul><li><a href="#v0-7">v0</a></li> <li><a href="#v2-7">v2</a></li></ul></li> <li><a href="#storagepoweractor">StoragePowerActor</a> <ul><li><a href="#v0-8">v0</a></li> <li><a href="#v2-8">v2</a></li></ul></li> <li><a href="#verifiedregistryactor">VerifiedRegistryActor</a> <ul><li><a href="#v0-9">v0</a></li> <li><a href="#v2-9">v2</a></li></ul></li> <li><a href="#systemactor">SystemActor</a> <ul><li><a href="#v0-10">v0</a></li> <li><a href="#v2-10">v2</a></li></ul></li></ul> <p>The Actor State tree attaches to the main chain via the <code>ParentStateRoot</code> field of <code>BlockHeader</code>. This field either points directly to the <code>ActorsHAMT</code> in v0 or via the intermediate <code>StateRoot</code> from v2.</p> <p>See <a href="/data-structures/filecoin/chain.html#actor-type-linking">Actor type linking</a> for how each of the Actor State blocks below are attached to and differentiated within the <code>ActorsHAMT</code>.</p> <h2 id="initactor"><a href="#initactor" class="header-anchor">#</a> InitActor</h2> <p>The InitActor state is the same in v0 and v2.</p> <h3 id="v0"><a href="#v0" class="header-anchor">#</a> v0</h3> <p><a name="initv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">InitV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  AddressMap <span class="token punctuation">&amp;</span>ActorIDHAMT <span class="token comment"># HAMT[Address]ActorID</span>
  NextID ActorID
  NetworkName String
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2"><a href="#v2" class="header-anchor">#</a> v2</h3> <p><em>(Same as v0)</em></p> <p><a name="initv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">InitV2State</span></span> InitV0State
</code></pre></div><p><strong>HAMT</strong>: This is an ADL representing <code>type ActorIDHAMT {Address:ActorID}</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ActorIDHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> ActorIDHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ActorIDHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> ActorIDHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> ActorIDHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ActorIDHAMTLink</span></span> <span class="token punctuation">&amp;</span>ActorIDHAMT

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ActorIDHAMTBucket</span></span> <span class="token punctuation">[</span> ActorIDHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ActorIDHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key Address
  value ActorID
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h2 id="cronactor"><a href="#cronactor" class="header-anchor">#</a> CronActor</h2> <p>The CronActor state is the same in v0 and v2.</p> <h3 id="v0-2"><a href="#v0-2" class="header-anchor">#</a> v0</h3> <p><a name="cronv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">CronV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Entries <span class="token punctuation">[</span>CronV0Entry<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">CronV0Entry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># The actor to call (must be an ID-address)</span>
  Receiver Address
  <span class="token comment"># The method number to call (must accept empty parameters)</span>
  MethodNum MethodNum
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-2"><a href="#v2-2" class="header-anchor">#</a> v2</h3> <p><em>(Same as v0)</em></p> <p><a name="cronv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">CronV2State</span></span> CronV0State
</code></pre></div><h2 id="rewardactor"><a href="#rewardactor" class="header-anchor">#</a> RewardActor</h2> <p>The RewardActor state differs between v0 and v2.</p> <h3 id="v0-3"><a href="#v0-3" class="header-anchor">#</a> v0</h3> <p><a name="rewardv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">RewardV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># CumsumBaseline is a target CumsumRealized needs to reach for EffectiveNetworkTime to increase</span>
  <span class="token comment"># CumsumBaseline and CumsumRealized are expressed in byte-epochs.</span>
  CumsumBaseline Spacetime
  <span class="token comment"># CumsumRealized is cumulative sum of network power capped by BalinePower(epoch)</span>
  CumsumRealized Spacetime
  <span class="token comment"># EffectiveNetworkTime is ceiling of real effective network time `theta` based on</span>
  <span class="token comment"># CumsumBaselinePower(theta) == CumsumRealizedPower</span>
  <span class="token comment"># Theta captures the notion of how much the network has progressed in its baseline</span>
  <span class="token comment"># and in advancing network time.</span>
  EffectiveNetworkTime ChainEpoch
  <span class="token comment"># EffectiveBaselinePower is the baseline power at the EffectiveNetworkTime epoch</span>
  EffectiveBaselinePower StoragePower
  <span class="token comment"># The reward to be paid in per WinCount to block producers.</span>
  <span class="token comment"># The actual reward total paid out depends on the number of winners in any round.</span>
  <span class="token comment"># This value is recomputed every non-null epoch and used in the next non-null epoch.</span>
  ThisEpochReward TokenAmount
  <span class="token comment"># Smoothed ThisEpochReward</span>
  ThisEpochRewardSmoothed <span class="token keyword">nullable</span> FilterEstimate
  <span class="token comment"># The baseline power the network is targeting at st.Epoch</span>
  ThisEpochBaselinePower StoragePower
  <span class="token comment"># Epoch tracks for which epoch the Reward was computed</span>
  Epoch ChainEpoch
  <span class="token comment"># TotalMined tracks the total FIL awared to block miners</span>
  TotalMined TokenAmount
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Alpha Beta Filter &quot;position&quot; (value) and &quot;velocity&quot; (rate of change of value) estimates</span>
<span class="token comment"># Estimates are in Q.128 format</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">FilterEstimate</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  PositionEstimate BigInt <span class="token comment"># Q.128</span>
  VelocityEstimate BigInt <span class="token comment"># Q.128</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-3"><a href="#v2-3" class="header-anchor">#</a> v2</h3> <p><a name="rewardv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">RewardV2State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># CumsumBaseline is a target CumsumRealized needs to reach for EffectiveNetworkTime to increase</span>
  <span class="token comment"># CumsumBaseline and CumsumRealized are expressed in byte-epochs.</span>
  CumsumBaseline Spacetime
  <span class="token comment"># CumsumRealized is cumulative sum of network power capped by BaselinePower(epoch)</span>
  CumsumRealized Spacetime
  <span class="token comment"># EffectiveNetworkTime is ceiling of real effective network time `theta` based on</span>
  <span class="token comment"># CumsumBaselinePower(theta) == CumsumRealizedPower</span>
  <span class="token comment"># Theta captures the notion of how much the network has progressed in its baseline</span>
  <span class="token comment"># and in advancing network time.</span>
  EffectiveNetworkTime ChainEpoch
  <span class="token comment"># EffectiveBaselinePower is the baseline power at the EffectiveNetworkTime epoch</span>
  EffectiveBaselinePower StoragePower
  <span class="token comment"># The reward to be paid in per WinCount to block producers.</span>
  <span class="token comment"># The actual reward total paid out depends on the number of winners in any round.</span>
  <span class="token comment"># This value is recomputed every non-null epoch and used in the next non-null epoch.</span>
  ThisEpochReward TokenAmount
  <span class="token comment"># Smoothed ThisEpochReward</span>
  ThisEpochRewardSmoothed FilterEstimate
  <span class="token comment"># The baseline power the network is targeting at st.Epoch</span>
  ThisEpochBaselinePower StoragePower
  <span class="token comment"># Epoch tracks for which epoch the Reward was computed</span>
  Epoch ChainEpoch
  <span class="token comment"># TotalStoragePowerReward tracks the total FIL awarded to block miners</span>
  TotalStoragePowerReward TokenAmount
  <span class="token comment"># Simple and Baseline totals are constants used for computing rewards.</span>
  <span class="token comment"># They are on chain because of a historical fix resetting baseline value</span>
  <span class="token comment"># in a way that depended on the history leading immediately up to the</span>
  <span class="token comment"># migration fixing the value.  These values can be moved from state back</span>
  <span class="token comment"># into a code constant in a subsequent upgrade.</span>
  SimpleTotal BigInt
  BaselineTotal BigInt
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h2 id="accountactor"><a href="#accountactor" class="header-anchor">#</a> AccountActor</h2> <p>The CronActor state is the same in v0 and v2 and only contains an <code>Address</code>.</p> <h3 id="v0-4"><a href="#v0-4" class="header-anchor">#</a> v0</h3> <p><a name="accountv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">AccountV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Address Address
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-4"><a href="#v2-4" class="header-anchor">#</a> v2</h3> <p><em>(Same as v0)</em></p> <p><a name="accountv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">AccountV2State</span></span> AccountV0State
</code></pre></div><h2 id="storagemarketactor"><a href="#storagemarketactor" class="header-anchor">#</a> StorageMarketActor</h2> <p>The StorageMarketActor state is the same in v0 and v2.</p> <h3 id="v0-5"><a href="#v0-5" class="header-anchor">#</a> v0</h3> <p><a name="marketv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MarketV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Proposals <span class="token punctuation">&amp;</span>DealProposalAMT <span class="token comment"># AMT[DealID]DealProposal</span>
  States <span class="token punctuation">&amp;</span>DealStateAMT <span class="token comment"># AMT[DealID]DealState</span>
  <span class="token comment"># PendingProposals tracks dealProposals that have not yet reached their deal start date.</span>
  <span class="token comment"># We track them here to ensure that miners can't publish the same deal proposal twice.</span>
  PendingProposals <span class="token punctuation">&amp;</span>DealProposalHAMT <span class="token comment"># HAMT[DealCid]DealProposal</span>
  <span class="token comment"># Total amount held in escrow, indexed by actor address (including both locked and unlocked amounts).</span>
  EscrowTable <span class="token punctuation">&amp;</span>BalanceTableHAMT <span class="token comment"># HAMT[Address]TokenAmount</span>
  <span class="token comment"># Amount locked, indexed by actor address.</span>
  <span class="token comment"># Note: the amounts in this table do not affect the overall amount in escrow:</span>
  <span class="token comment"># only the _portion_ of the total escrow amount that is locked.</span>
  LockedTable <span class="token punctuation">&amp;</span>BalanceTableHAMT <span class="token comment"># HAMT[Address]TokenAmount</span>
  NextID DealID
  <span class="token comment"># Metadata cached for efficient iteration over deals.</span>
  DealOpsByEpoch <span class="token punctuation">&amp;</span>DealOpsByEpochHAMT <span class="token comment"># SetMultimap: HAMT[ChainEpoch]Set[DealID]</span>
  LastCron ChainEpoch
  <span class="token comment"># Total Client Collateral that is locked -&gt; unlocked when deal is terminated</span>
  TotalClientLockedCollateral TokenAmount
  <span class="token comment"># Total Provider Collateral that is locked -&gt; unlocked when deal is terminated</span>
  TotalProviderLockedCollateral TokenAmount
  <span class="token comment"># Total storage fee that is locked in escrow -&gt; unlocked when payments are made</span>
  TotalClientStorageFee TokenAmount
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-5"><a href="#v2-5" class="header-anchor">#</a> v2</h3> <p><em>(Same as v0)</em></p> <p><a name="marketv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MarketV2State</span></span> MarketV0State
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type DealProposalList [DealProposal]</code>, indexed by <code>DealID</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealProposalAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node DealProposalAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealProposalAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>DealProposalAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>MarketV0DealProposal<span class="token punctuation">]</span> <span class="token comment"># inline</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MarketV0DealProposal</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># CommP: A CID with fil-commitment-unsealed + sha2_256-trunc254-padded</span>
  PieceCID <span class="token punctuation">&amp;</span>Any
  PieceSize PaddedPieceSize
  VerifiedDeal Bool
  Client Address
  Provider Address
  <span class="token comment"># An arbitrary client chosen label to apply to the deal</span>
  Label String
  <span class="token comment"># Nominal start epoch. Deal payment is linear between StartEpoch and EndEpoch,</span>
  <span class="token comment"># with total amount StoragePricePerEpoch * (EndEpoch - StartEpoch).</span>
  <span class="token comment"># Storage deal must appear in a sealed (proven) sector no later than StartEpoch,</span>
  <span class="token comment"># otherwise it is invalid.</span>
  StartEpoch ChainEpoch
  EndEpoch ChainEpoch
  StoragePricePerEpoch TokenAmount
  ProviderCollateral TokenAmount
  ClientCollateral TokenAmount
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type DealProposalList [DealState]</code>, indexed by <code>DealID</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealStateAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node DealStateAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealStateAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>DealStateAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>MarketV0DealState<span class="token punctuation">]</span> <span class="token comment"># inline</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MarketV0DealState</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  SectorStartEpoch ChainEpoch <span class="token comment"># -1 if not yet included in proven sector</span>
  LastUpdatedEpoch ChainEpoch <span class="token comment"># -1 if deal state never updated</span>
  SlashEpoch ChainEpoch <span class="token comment"># -1 if deal never slashed</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>HAMT</strong>: This is an ADL representing <code>type DealProposalMap {DealCidBytes:DealProposal}</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># The bytes form of the the CID of a `MarketV0DealProposal` object as a block</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealCidBytes</span></span> <span class="token keyword">bytes</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealProposalHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> DealProposalHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealProposalHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> DealProposalHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> Bucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealProposalHAMTLink</span></span> <span class="token punctuation">&amp;</span>DealProposalHAMT

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealProposalHAMTBucket</span></span> <span class="token punctuation">[</span> DealProposalHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealProposalHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key DealCidBytes
  value MarketV0DealProposal
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>HAMT</strong>: This is an ADL representing <code>type BalanceTable {Address:TokenAmount}</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">BalanceTableHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> BalanceTableHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">BalanceTableHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> BalanceTableHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> BalanceTableHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">BalanceTableHAMTLink</span></span> <span class="token punctuation">&amp;</span>BalanceTableHAMT

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">BalanceTableHAMTBucket</span></span> <span class="token punctuation">[</span> BalanceTableHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">BalanceTableHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key Address
  value TokenAmount
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>SetMultimap (HAMT+HAMT)</strong>: This is an ADL representing a Set within a Map <code>type DealOpsByEpoch {ChainEpochBytes:{DealIDBytes:Null}}</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># HAMT/map root structure</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> DealOpsByEpochHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> DealOpsByEpochHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> DealOpsByEpochHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTLink</span></span> <span class="token punctuation">&amp;</span>DealOpsByEpochHAMTLink

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTBucket</span></span> <span class="token punctuation">[</span> DealOpsByEpochHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key ChainEpochBytes
  value <span class="token punctuation">&amp;</span>DealOpsByEpochAMT
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># HAMT/set leaf structure (map of nulls)</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTSet</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> DealOpsByEpochHAMTSetElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTSetElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> DealOpsByEpochHAMTSet_Link <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> DealOpsByEpochHAMTSetBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTSet_Link</span></span> <span class="token punctuation">&amp;</span>DealOpsByEpochHAMTSet

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTSetBucket</span></span> <span class="token punctuation">[</span> DealOpsByEpochHAMTSetBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DealOpsByEpochHAMTSetBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key DealIDBytes
  value Null
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h2 id="storagemineractor"><a href="#storagemineractor" class="header-anchor">#</a> StorageMinerActor</h2> <h3 id="v0-6"><a href="#v0-6" class="header-anchor">#</a> v0</h3> <p><a name="minerv0state"></a></p> <blockquote><p>Balance of Miner Actor should be greater than or equal to
the sum of PreCommitDeposits and LockedFunds.
It is possible for balance to fall below the sum of
PCD, LF and InitialPledgeRequirements, and this is a bad
state (IP Debt) that limits a miner actor's behavior (i.e. no balance withdrawals)
Excess balance as computed by st.GetAvailableBalance will be
withdrawable or usable for pre-commit deposit or pledge lock-up.</p></blockquote> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Information not related to sectors</span>
  Info  <span class="token punctuation">&amp;</span>MinerV0Info
  <span class="token comment"># Total funds locked as PreCommitDeposits</span>
  PreCommitDeposits TokenAmount
  <span class="token comment"># Total rewards and added funds locked in vesting table</span>
  LockedFunds TokenAmount
  <span class="token comment"># VestingFunds (Vesting Funds schedule for the miner)</span>
  VestingFunds <span class="token punctuation">&amp;</span>MinerV0VestingFunds
  <span class="token comment"># Sum of initial pledge requirements of all active sectors</span>
  InitialPledge TokenAmount
  <span class="token comment"># Sectors that have been pre-committed but not yet proven.</span>
  PreCommittedSectors <span class="token punctuation">&amp;</span>MinerV0SectorPreCommitOnChainInfoHAMT <span class="token comment"># HAMT[SectorNumber]SectorPreCommitOnChainInfo</span>
  <span class="token comment"># PreCommittedSectorsExpiry maintains the state required to expire PreCommittedSectors</span>
  PreCommittedSectorsExpiry <span class="token punctuation">&amp;</span>BitFieldQueueAMT <span class="token comment"># AMT[ChainEpoch]BitField</span>
  <span class="token comment"># Allocated sector IDs. Sector IDs can never be reused once allocated</span>
  AllocatedSectors <span class="token punctuation">&amp;</span>BitField
  <span class="token comment"># Information for all proven and not-yet-garbage-collected sectors.</span>
  <span class="token comment"># Sectors are removed from this AMT when the partition to which the</span>
  <span class="token comment"># sector belongs is compacted.</span>
  Sectors <span class="token punctuation">&amp;</span>MinerV0SectorOnChainInfoAMT <span class="token comment"># AMT[SectorNumber]SectorOnChainInfo</span>
  <span class="token comment"># The first epoch in this miner's current proving period. This is the first epoch in which a PoSt for a</span>
  <span class="token comment"># partition at the miner's first deadline may arrive. Alternatively, it is after the last epoch at which</span>
  <span class="token comment"># a PoSt for the previous window is valid.</span>
  <span class="token comment"># Always greater than zero, this may be greater than the current epoch for genesis miners in the first</span>
  <span class="token comment"># WPoStProvingPeriod epochs of the chain; the epochs before the first proving period starts are exempt from Window</span>
  <span class="token comment"># PoSt requirements.</span>
  <span class="token comment"># Updated at the end of every period by a cron callback.</span>
  ProvingPeriodStart ChainEpoch
  <span class="token comment"># Index of the deadline within the proving period beginning at ProvingPeriodStart that has not yet been</span>
  <span class="token comment"># finalized.</span>
  <span class="token comment"># Updated at the end of each deadline window by a cron callback.</span>
  CurrentDeadline Int
  <span class="token comment"># The sector numbers due for PoSt at each deadline in the current proving period, frozen at period start.</span>
  <span class="token comment"># New sectors are added and expired ones removed at proving period boundary.</span>
  <span class="token comment"># Faults are not subtracted from this in state, but on the fly.</span>
  Deadlines <span class="token punctuation">&amp;</span>MinerV0Deadlines
  <span class="token comment"># Deadlines with outstanding fees for early sector termination</span>
  EarlyTerminations BitField
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0Info</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Account that owns this miner.</span>
  <span class="token comment"># - Income and returned collateral are paid to this address.</span>
  <span class="token comment"># - This address is also allowed to change the worker address for the miner.</span>
  Owner Address <span class="token comment"># Must be an ID-address</span>
  <span class="token comment"># Worker account for this miner.</span>
  <span class="token comment"># The associated pubkey-type address is used to sign blocks and messages on behalf of this miner.</span>
  Worker Address <span class="token comment"># Must be an ID-address.</span>
  <span class="token comment"># Additional addresses that are permitted to submit messages controlling this actor (optional)</span>
  ControlAddresses <span class="token keyword">nullable</span> <span class="token punctuation">[</span>Address<span class="token punctuation">]</span>
  PendingWorkerKey <span class="token keyword">nullable</span> MinerV0WorkerKeyChange
  <span class="token comment"># Byte array representing a Libp2p identity that should be used when connecting to this miner</span>
  PeerId PeerID
  <span class="token comment"># Slice of byte arrays representing Libp2p multi-addresses used for establishing a connection with this miner</span>
  Multiaddrs <span class="token keyword">nullable</span> <span class="token punctuation">[</span>Multiaddr<span class="token punctuation">]</span>
  <span class="token comment"># The proof type used by this miner for sealing sectors</span>
  SealProofType Int
  <span class="token comment"># Amount of space in each sector committed by this miner.</span>
  <span class="token comment"># This is computed from the proof type and represented here redundantly.</span>
  SectorSize SectorSize
  <span class="token comment"># The number of sectors in each Window PoSt partition (proof).</span>
  <span class="token comment"># This is computed from the proof type and represented here redundantly.</span>
  WindowPoStPartitionSectors Int
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0WorkerKeyChange</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  NewWorker Address <span class="token comment"># Must be an ID address</span>
  EffectiveAt ChainEpoch
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># VestingFunds represents the vesting table state for the miner.</span>
<span class="token comment"># It is a slice of (VestingEpoch, VestingAmount).</span>
<span class="token comment"># The slice will always be sorted by the VestingEpoch.</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0VestingFunds</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Funds <span class="token punctuation">[</span>MinerV0VestingFund<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># VestingFund represents miner funds that will vest at the given epoch.</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0VestingFund</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Epoch ChainEpoch
  Amount TokenAmount
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># Deadlines contains Deadline objects, describing the sectors due at the given</span>
<span class="token comment"># deadline and their state (faulty, terminated, recovering, etc.).</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0Deadlines</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Due MinerV0DeadlineLinkList
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Must be 48 CIDs</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0DeadlineLinkList</span></span> <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>MinerV0Deadline<span class="token punctuation">]</span>
</code></pre></div><div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># Deadline holds the state for all sectors due at a specific deadline.</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0Deadline</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Partitions in this deadline, in order.</span>
  <span class="token comment"># The keys of this AMT are always sequential integers beginning with zero.</span>
  Partitions <span class="token punctuation">&amp;</span>MinerV0PartitionAMT <span class="token comment"># AMT[PartitionNumber]Partition</span>
  <span class="token comment"># Maps epochs to partitions that _may_ have sectors that expire in or</span>
  <span class="token comment"># before that epoch, either on-time or early as faults.</span>
  <span class="token comment"># Keys are quantized to final epochs in each proving deadline.</span>
  <span class="token comment"># NOTE: Partitions MUST NOT be removed from this queue (until the</span>
  <span class="token comment"># associated epoch has passed) even if they no longer have sectors</span>
  <span class="token comment"># expiring at that epoch. Sectors expiring at this epoch may later be</span>
  <span class="token comment"># recovered, and this queue will not be updated at that time.</span>
  ExpirationEpochs <span class="token punctuation">&amp;</span>BitFieldQueueAMT <span class="token comment"># AMT[ChainEpoch]BitField</span>
  <span class="token comment"># Partitions numbers with PoSt submissions since the proving period started.</span>
  PostSubmissions BitField
  <span class="token comment"># Partitions with sectors that terminated early.</span>
  EarlyTerminations BitField
  <span class="token comment"># The number of non-terminated sectors in this deadline (incl faulty).</span>
  LiveSectors Int
  <span class="token comment"># The total number of sectors in this deadline (incl dead).</span>
  TotalSectors Int
  <span class="token comment"># Memoized sum of faulty power in partitions.</span>
  FaultyPower MinerV0PowerPair
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-6"><a href="#v2-6" class="header-anchor">#</a> v2</h3> <p><a name="minerv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Information not related to sectors</span>
  Info  <span class="token punctuation">&amp;</span>MinerV2Info
  <span class="token comment"># Total funds locked as PreCommitDeposits</span>
  PreCommitDeposits TokenAmount
  <span class="token comment"># Total rewards and added funds locked in vesting table</span>
  LockedFunds TokenAmount
  <span class="token comment"># VestingFunds (Vesting Funds schedule for the miner)</span>
  VestingFunds <span class="token punctuation">&amp;</span>MinerV0VestingFunds
  <span class="token comment"># Absolute value of debt this miner owes from unpaid fees</span>
  FeeDebt TokenAmount
  <span class="token comment"># Sum of initial pledge requirements of all active sectors</span>
  InitialPledge TokenAmount
  <span class="token comment"># Sectors that have been pre-committed but not yet proven</span>
  PreCommittedSectors <span class="token punctuation">&amp;</span>MinerV0SectorPreCommitOnChainInfoHAMT <span class="token comment"># HAMT[SectorNumber]SectorPreCommitOnChainInfo</span>
  <span class="token comment"># PreCommittedSectorsExpiry maintains the state required to expire PreCommittedSectors</span>
  PreCommittedSectorsExpiry <span class="token punctuation">&amp;</span>BitFieldQueueAMT <span class="token comment"># AMT[ChainEpoch]BitField</span>
  <span class="token comment"># Allocated sector IDs. Sector IDs can never be reused once allocated</span>
  AllocatedSectors <span class="token punctuation">&amp;</span>BitField
  <span class="token comment"># Information for all proven and not-yet-garbage-collected sectors.</span>
  <span class="token comment"># Sectors are removed from this AMT when the partition to which the</span>
  <span class="token comment"># sector belongs is compacted.</span>
  Sectors <span class="token punctuation">&amp;</span>MinerV2SectorOnChainInfoAMT <span class="token comment"># AMT[SectorNumber]SectorOnChainInfo</span>
  <span class="token comment"># The first epoch in this miner's current proving period. This is the first epoch in which a PoSt for a</span>
  <span class="token comment"># partition at the miner's first deadline may arrive. Alternatively, it is after the last epoch at which</span>
  <span class="token comment"># a PoSt for the previous window is valid.</span>
  <span class="token comment"># Always greater than zero, this may be greater than the current epoch for genesis miners in the first</span>
  <span class="token comment"># WPoStProvingPeriod epochs of the chain; the epochs before the first proving period starts are exempt from Window</span>
  <span class="token comment"># PoSt requirements.</span>
  <span class="token comment"># Updated at the end of every period by a cron callback.</span>
  ProvingPeriodStart ChainEpoch
  <span class="token comment"># Index of the deadline within the proving period beginning at ProvingPeriodStart that has not yet been</span>
  <span class="token comment"># finalized.</span>
  <span class="token comment"># Updated at the end of each deadline window by a cron callback.</span>
  CurrentDeadline Int
  <span class="token comment"># The sector numbers due for PoSt at each deadline in the current proving period, frozen at period start.</span>
  <span class="token comment"># New sectors are added and expired ones removed at proving period boundary.</span>
  <span class="token comment"># Faults are not subtracted from this in state, but on the fly.</span>
  Deadlines <span class="token punctuation">&amp;</span>MinerV2Deadlines
  <span class="token comment"># Deadlines with outstanding fees for early sector termination</span>
  EarlyTerminations BitField
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2Info</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Account that owns this miner.</span>
  <span class="token comment"># - Income and returned collateral are paid to this address.</span>
  <span class="token comment"># - This address is also allowed to change the worker address for the miner.</span>
  Owner Address <span class="token comment"># Must be an ID-address</span>
  <span class="token comment"># Worker account for this miner.</span>
  <span class="token comment"># The associated pubkey-type address is used to sign blocks and messages on behalf of this miner.</span>
  Worker Address <span class="token comment"># Must be an ID-address</span>
  <span class="token comment"># Additional addresses that are permitted to submit messages controlling this actor (optional).</span>
  ControlAddresses <span class="token keyword">nullable</span> <span class="token punctuation">[</span>Address<span class="token punctuation">]</span> <span class="token comment"># Must all be ID addresses</span>
  PendingWorkerKey <span class="token keyword">nullable</span> MinerV0WorkerKeyChange
  <span class="token comment"># Byte array representing a Libp2p identity that should be used when connecting to this miner.</span>
  PeerId PeerID
  <span class="token comment"># Slice of byte arrays representing Libp2p multi-addresses used for establishing a connection with this miner.</span>
  Multiaddrs <span class="token keyword">nullable</span> <span class="token punctuation">[</span>Multiaddr<span class="token punctuation">]</span>
  <span class="token comment"># The proof type used by this miner for sealing sectors.</span>
  SealProofType Int
  <span class="token comment"># Amount of space in each sector committed by this miner.</span>
  <span class="token comment"># This is computed from the proof type and represented here redundantly.</span>
  SectorSize SectorSize
  <span class="token comment"># The number of sectors in each Window PoSt partition (proof).</span>
  <span class="token comment"># This is computed from the proof type and represented here redundantly.</span>
  WindowPoStPartitionSectors Int
  <span class="token comment"># The next epoch this miner is eligible for certain permissioned actor methods</span>
  <span class="token comment"># and winning block elections as a result of being reported for a consensus fault.</span>
  ConsensusFaultElapsed ChainEpoch
  <span class="token comment"># A proposed new owner account for this miner.</span>
  <span class="token comment"># Must be confirmed by a message from the pending address itself.</span>
  PendingOwnerAddress <span class="token keyword">nullable</span> Address
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p>Ssame form as <code>MinerV0Deadlines</code> but the eventual link to <code>MinerV2Partition</code> is different.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># Deadlines contains Deadline objects, describing the sectors due at the given</span>
<span class="token comment"># deadline and their state (faulty, terminated, recovering, etc.).</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2Deadlines</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Due MinerV2DeadlineLinkList
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Must be 48 CIDs</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2DeadlineLinkList</span></span> <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>MinerV2Deadline<span class="token punctuation">]</span>
</code></pre></div><div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># Deadline holds the state for all sectors due at a specific deadline.</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2Deadline</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Partitions in this deadline, in order.</span>
  <span class="token comment"># The keys of this AMT are always sequential integers beginning with zero.</span>
  Partitions <span class="token punctuation">&amp;</span>MinerV2PartitionAMT <span class="token comment"># AMT[PartitionNumber]Partition</span>
  <span class="token comment"># Maps epochs to partitions that _may_ have sectors that expire in or</span>
  <span class="token comment"># before that epoch, either on-time or early as faults.</span>
  <span class="token comment"># Keys are quantized to final epochs in each proving deadline.</span>
  <span class="token comment"># NOTE: Partitions MUST NOT be removed from this queue (until the</span>
  <span class="token comment"># associated epoch has passed) even if they no longer have sectors</span>
  <span class="token comment"># expiring at that epoch. Sectors expiring at this epoch may later be</span>
  <span class="token comment"># recovered, and this queue will not be updated at that time.</span>
  ExpirationEpochs <span class="token punctuation">&amp;</span>BitFieldQueueAMT <span class="token comment"># AMT[ChainEpoch]BitField</span>
  <span class="token comment"># Partitions numbers with PoSt submissions since the proving period started.</span>
  PostSubmissions BitField
  <span class="token comment"># Partitions with sectors that terminated early.</span>
  EarlyTerminations BitField
  <span class="token comment"># The number of non-terminated sectors in this deadline (incl faulty).</span>
  LiveSectors Int
  <span class="token comment"># The total number of sectors in this deadline (incl dead).</span>
  TotalSectors Int
  <span class="token comment"># Memoized sum of faulty power in partitions.</span>
  FaultyPower MinerV0PowerPair
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>HAMT</strong>: This is an ADL representing <code>type SectorPreCommitOnChainInfoMap {SectorNumberBytes:SectorPreCommitOnChainInfo}</code></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorPreCommitOnChainInfoHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> MinerV0SectorPreCommitOnChainInfoHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorPreCommitOnChainInfoHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> MinerV0SectorPreCommitOnChainInfoHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> MinerV0SectorPreCommitOnChainInfoHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorPreCommitOnChainInfoHAMTLink</span></span> <span class="token punctuation">&amp;</span>MinerV0SectorPreCommitOnChainInfoHAMT

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorPreCommitOnChainInfoHAMTBucket</span></span> <span class="token punctuation">[</span> MinerV0SectorPreCommitOnChainInfoHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorPreCommitOnChainInfoHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key SectorNumberBytes
  value MinerV0SectorPreCommitOnChainInfo <span class="token comment"># inline</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Information stored on-chain for a pre-committed sector</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorPreCommitOnChainInfo</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Info MinerV0SectorPreCommitInfo
  PreCommitDeposit TokenAmount
  PreCommitEpoch ChainEpoch
  <span class="token comment"># Integral of active deals over sector lifetime</span>
  DealWeight DealWeight
  <span class="token comment"># Integral of active verified deals over sector lifetime</span>
  VerifiedDealWeight DealWeight
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Information provided by a miner when pre-committing a sector</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorPreCommitInfo</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  SealProof RegisteredSealProof
  SectorNumber SectorNumber
  <span class="token comment"># CommR: A CID with fil-commitment-sealed + poseidon-bls12_381-ac-fc1</span>
  SealedCID <span class="token punctuation">&amp;</span>Any
  SealRandEpoch ChainEpoch
  DealIDs <span class="token punctuation">[</span>DealID<span class="token punctuation">]</span>
  Expiration ChainEpoch
  <span class="token comment"># Whether to replace a &quot;committed capacity&quot; no-deal sector (requires non-empty DealIDs)</span>
  ReplaceCapacity Bool
  <span class="token comment"># The committed capacity sector to replace, and it's deadline/partition location</span>
  ReplaceSectorDeadline Int
  ReplaceSectorPartition PartitionNumber
  ReplaceSectorNumber SectorNumber
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type BitFieldQueue [BitField]</code> indexed by <code>ChainEpoch</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">BitFieldQueueAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node BitFieldQueueAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">BitFieldQueueAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>BitFieldQueueAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>Bitfield<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type V0SectorOnChainInfoList [V0SectorOnChainInfo]</code> indexed by <code>SectorNumber</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorOnChainInfoAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node MinerV0SectorOnChainInfoAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorOnChainInfoAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>MinerV0SectorOnChainInfoAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>MinerV0SectorOnChainInfo<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Information stored on-chain for a proven sector</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0SectorOnChainInfo</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  SectorNumber SectorNumber
  <span class="token comment"># The seal proof type implies the PoSt proof/s</span>
  SealProof RegisteredSealProof
  <span class="token comment"># CommR: A CID with fil-commitment-sealed + poseidon-bls12_381-ac-fc1</span>
  SealedCID <span class="token punctuation">&amp;</span>Any
  DealIDs <span class="token punctuation">[</span>DealID<span class="token punctuation">]</span>
  <span class="token comment"># Epoch during which the sector proof was accepted</span>
  Activation ChainEpoch
  <span class="token comment"># Epoch during which the sector expires</span>
  Expiration ChainEpoch
  <span class="token comment"># Integral of active deals over sector lifetime</span>
  DealWeight DealWeight
  <span class="token comment"># Integral of active verified deals over sector lifetime</span>
  VerifiedDealWeight DealWeight
  <span class="token comment"># Pledge collected to commit this sector</span>
  InitialPledge TokenAmount
  <span class="token comment"># Expected one day projection of reward for sector computed at activation time</span>
  ExpectedDayReward TokenAmount
  <span class="token comment"># Expected twenty day projection of reward for sector computed at activation time</span>
  ExpectedStoragePledge TokenAmount
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type V2SectorOnChainInfoList [V2SectorOnChainInfo]</code> indexed by <code>SectorNumber</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2SectorOnChainInfoAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node MinerV2SectorOnChainInfoAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2SectorOnChainInfoAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>MinerV2SectorOnChainInfoAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>MinerV2SectorOnChainInfo<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Information stored on-chain for a proven sector</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2SectorOnChainInfo</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  SectorNumber SectorNumber
  <span class="token comment"># The seal proof type implies the PoSt proof/s</span>
  SealProof RegisteredSealProof
  <span class="token comment"># CommR: A CID with fil-commitment-sealed + poseidon-bls12_381-ac-fc1</span>
  SealedCID <span class="token punctuation">&amp;</span>Any
  DealIDs <span class="token punctuation">[</span>DealID<span class="token punctuation">]</span>
  <span class="token comment"># Epoch during which the sector proof was accepted</span>
  Activation ChainEpoch
  <span class="token comment"># Epoch during which the sector expires</span>
  Expiration ChainEpoch
  <span class="token comment"># Integral of active deals over sector lifetime</span>
  DealWeight DealWeight
  <span class="token comment"># Integral of active verified deals over sector lifetime</span>
  VerifiedDealWeight DealWeight
  <span class="token comment"># Pledge collected to commit this sector</span>
  InitialPledge TokenAmount
  <span class="token comment"># Expected one day projection of reward for sector computed at activation time</span>
  ExpectedDayReward TokenAmount
  <span class="token comment"># Expected twenty day projection of reward for sector computed at activation time</span>
  ExpectedStoragePledge TokenAmount
  <span class="token comment"># Age of sector this sector replaced or zero</span>
  ReplacedSectorAge ChainEpoch
  <span class="token comment"># Day reward of sector this sector replace or zero</span>
  ReplacedDayReward TokenAmount
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type MinerV0PartitionList [MinerV0Partition]</code> indexed by <code>PartitionNumber</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0PartitionAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node MinerV0PartitionAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0PartitionAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>MinerV0PartitionAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>MinerV0Partition<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0Partition</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Sector numbers in this partition, including faulty and terminated sectors</span>
  Sectors BitField
  <span class="token comment"># Subset of sectors detected/declared faulty and not yet recovered (excl. from PoSt).</span>
  <span class="token comment"># Faults ∩ Terminated = ∅</span>
  Faults BitField
  <span class="token comment"># Subset of faulty sectors expected to recover on next PoSt</span>
  <span class="token comment"># Recoveries ∩ Terminated = ∅</span>
  Recoveries BitField
  <span class="token comment"># Subset of sectors terminated but not yet removed from partition (excl. from PoSt)</span>
  Terminated BitField
  <span class="token comment"># Maps epochs sectors that expire in or before that epoch.</span>
  <span class="token comment"># An expiration may be an &quot;on-time&quot; scheduled expiration, or early &quot;faulty&quot; expiration.</span>
  <span class="token comment"># Keys are quantized to last-in-deadline epochs.</span>
  ExpirationsEpochs <span class="token punctuation">&amp;</span>MinerV0ExpirationSetAMT <span class="token comment"># AMT[ChainEpoch]ExpirationSet</span>
  <span class="token comment"># Subset of terminated that were before their committed expiration epoch, by termination epoch.</span>
  <span class="token comment"># Termination fees have not yet been calculated or paid and associated deals have not yet been</span>
  <span class="token comment"># canceled but effective power has already been adjusted.</span>
  <span class="token comment"># Not quantized.</span>
  EarlyTerminated <span class="token punctuation">&amp;</span>BitFieldQueueAMT <span class="token comment"># AMT[ChainEpoch]BitField</span>
  <span class="token comment"># Power of not-yet-terminated sectors (incl faulty)</span>
  LivePower MinerV0PowerPair
  <span class="token comment"># Power of currently-faulty sectors. FaultyPower &lt;= LivePower.</span>
  FaultyPower MinerV0PowerPair
  <span class="token comment"># Power of expected-to-recover sectors. RecoveringPower &lt;= FaultyPower.</span>
  RecoveringPower MinerV0PowerPair
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Value type for a pair of raw and QA power</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0PowerPair</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Raw StoragePower
  QA StoragePower
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type MinerV2PartitionList [MinerV2Partition]</code> indexed by <code>PartitionNumber</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2PartitionAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node MinerV2PartitionAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2PartitionAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>MinerV2PartitionAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>MinerV2Partition<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV2Partition</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Sector numbers in this partition, including faulty, unproven, and terminated sectors</span>
  Sectors BitField
  <span class="token comment"># Unproven sectors in this partition. This bitfield will be cleared on</span>
  <span class="token comment"># a successful window post (or at the end of the partition's next</span>
  <span class="token comment"># deadline). At that time, any still unproven sectors will be added to</span>
  <span class="token comment"># the faulty sector bitfield.</span>
  Unproven BitField
  <span class="token comment"># Subset of sectors detected/declared faulty and not yet recovered (excl. from PoSt).</span>
  <span class="token comment"># Faults ∩ Terminated = ∅</span>
  Faults BitField
  <span class="token comment"># Subset of faulty sectors expected to recover on next PoSt</span>
  <span class="token comment"># Recoveries ∩ Terminated = ∅</span>
  Recoveries BitField
  <span class="token comment"># Subset of sectors terminated but not yet removed from partition (excl. from PoSt)</span>
  Terminated BitField
  <span class="token comment"># Maps epochs sectors that expire in or before that epoch.</span>
  <span class="token comment"># An expiration may be an &quot;on-time&quot; scheduled expiration, or early &quot;faulty&quot; expiration.</span>
  <span class="token comment"># Keys are quantized to last-in-deadline epochs.</span>
  ExpirationsEpochs <span class="token punctuation">&amp;</span>MinerV0ExpirationSetAMT <span class="token comment"># AMT[ChainEpoch]ExpirationSet</span>
  <span class="token comment"># Subset of terminated that were before their committed expiration epoch, by termination epoch.</span>
  <span class="token comment"># Termination fees have not yet been calculated or paid and associated deals have not yet been</span>
  <span class="token comment"># canceled but effective power has already been adjusted.</span>
  <span class="token comment"># Not quantized.</span>
  EarlyTerminated <span class="token punctuation">&amp;</span>BitFieldQueueAMT <span class="token comment"># AMT[ChainEpoch]BitField</span>
  <span class="token comment"># Power of not-yet-terminated sectors (incl faulty &amp; unproven)</span>
  LivePower MinerV0PowerPair
  <span class="token comment"># Power of yet-to-be-proved sectors (never faulty)</span>
  UnprovenPower MinerV0PowerPair
  <span class="token comment"># Power of currently-faulty sectors. FaultyPower &lt;= LivePower.</span>
  FaultyPower MinerV0PowerPair
  <span class="token comment"># Power of expected-to-recover sectors. RecoveringPower &lt;= FaultyPower.</span>
  RecoveringPower MinerV0PowerPair
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type MinerV0ExpirationSetList [MinerV0ExpirationSet]</code> indexed by <code>ChainEpoch</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0ExpirationSetAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node MinerV0ExpirationSetAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0ExpirationSetAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>MinerV0ExpirationSetAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>MinerV0ExpirationSet<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># ExpirationSet is a collection of sector numbers that are expiring, either due to</span>
<span class="token comment"># expected &quot;on-time&quot; expiration at the end of their life, or unexpected &quot;early&quot; termination</span>
<span class="token comment"># due to being faulty for too long consecutively.</span>
<span class="token comment"># Note that there is not a direct correspondence between on-time sectors and active power;</span>
<span class="token comment"># a sector may be faulty but expiring on-time if it faults just prior to expected termination.</span>
<span class="token comment"># Early sectors are always faulty, and active power always represents on-time sectors.</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MinerV0ExpirationSet</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Sectors expiring &quot;on time&quot; at the end of their committed life</span>
  OnTimeSectors BitField
  <span class="token comment"># Sectors expiring &quot;early&quot; due to being faulty for too long</span>
  EarlySectors BitField
  <span class="token comment"># Pledge total for the on-time sectors</span>
  OnTimePledge TokenAmount
  <span class="token comment"># Power that is currently active (not faulty)</span>
  ActivePower MinerV0PowerPair
  <span class="token comment"># Power that is currently faulty</span>
  FaultyPower MinerV0PowerPair
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h2 id="multisigactor"><a href="#multisigactor" class="header-anchor">#</a> MultisigActor</h2> <p>The MultisigActor state is the same in v0 and v2.</p> <h3 id="v0-7"><a href="#v0-7" class="header-anchor">#</a> v0</h3> <p><a name="multisigv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MultisigV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
   <span class="token comment"># Signers may be either public-key or actor ID-addresses. The ID address is canonical, but doesn't exist</span>
  <span class="token comment"># for a public key that has not yet received a message on chain.</span>
  <span class="token comment"># If any signer address is a public-key address, it will be resolved to an ID address and persisted</span>
  <span class="token comment"># in this state when the address is used.</span>
  Signers <span class="token punctuation">[</span>Address<span class="token punctuation">]</span>
  NumApprovalsThreshold Int
  NextTxnID TransactionID
  <span class="token comment"># Linear unlock</span>
  InitialBalance TokenAmount
  StartEpoch ChainEpoch
  UnlockDuration ChainEpoch
  PendingTxns <span class="token punctuation">&amp;</span>MultisigV0TransactionHAMT <span class="token comment"># HAMT[TransactionID]Multisigv0Transaction</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-7"><a href="#v2-7" class="header-anchor">#</a> v2</h3> <p><em>(Same as v0)</em></p> <p><a name="multisigv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MultisigV2State</span></span> MultisigV0State
</code></pre></div><p><strong>HAMT</strong>: This is an ADL representing <code>type MultisigV0TransactionMap {TransactionIDBytes:MultisigV0Transaction}</code></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MultisigV0TransactionHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> MultisigV0TransactionHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MultisigV0TransactionHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> MultisigV0TransactionHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> MultisigV0TransactionHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MultisigV0TransactionHAMTLink</span></span> <span class="token punctuation">&amp;</span>MultisigV0TransactionHAMT

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MultisigV0TransactionHAMTBucket</span></span> <span class="token punctuation">[</span> MultisigV0TransactionHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MultisigV0TransactionHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key Bytes
  value MultisigV0Transaction <span class="token comment"># inline</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">MultisigV0Transaction</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  To Address
  Value TokenAmount
  Method MethodNum
  Params CborEncodedParams
  <span class="token comment"># This address at index 0 is the transaction proposer, order of this slice must be preserved.</span>
  Approved <span class="token punctuation">[</span>Address<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h2 id="paymentchannelactor"><a href="#paymentchannelactor" class="header-anchor">#</a> PaymentChannelActor</h2> <p>The PaymentChannelActor state is the same in v0 and v2.</p> <h3 id="v0-8"><a href="#v0-8" class="header-anchor">#</a> v0</h3> <p><a name="paychv0state"></a></p> <blockquote><p>A given payment channel actor is established by From
to enable off-chain microtransactions to To to be reconciled
and tallied on chain.</p></blockquote> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PaychV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Channel owner, who has funded the actor</span>
  From Address
  <span class="token comment"># Recipient of payouts from channel</span>
  To Address
  <span class="token comment"># Amount successfully redeemed through the payment channel, paid out on `Collect()`</span>
  ToSend BigInt
  <span class="token comment"># Height at which the channel can be `Collected`</span>
  SettlingAt ChainEpoch
  <span class="token comment"># Height before which the channel `ToSend` cannot be collected</span>
  MinSettleHeight ChainEpoch
  <span class="token comment"># Collections of lane states for the channel, maintained in ID order.</span>
  LaneStates <span class="token punctuation">&amp;</span>PaychV0LaneStatesAMT <span class="token comment"># AMT[Int]PaychV0LaneState</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-8"><a href="#v2-8" class="header-anchor">#</a> v2</h3> <p><em>(Same as v0)</em></p> <p><a name="paychv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PaychV2State</span></span> PaychV0State
</code></pre></div><p><strong>AMT</strong>: This is an ADL representing <code>type PaychV0LaneStates [PaychV0LaneState]</code> indexed by Lane ID.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PaychV0LaneStatesAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node PaychV0LaneStatesAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PaychV0LaneStatesAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>PaychV0LaneStatesAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>PaychV0LaneState<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># The Lane state tracks the latest (highest) voucher nonce used to merge the lane</span>
<span class="token comment"># as well as the amount it has already redeemed.</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PaychV0LaneState</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  Redeemed BigInt
  Nonce Int
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h2 id="storagepoweractor"><a href="#storagepoweractor" class="header-anchor">#</a> StoragePowerActor</h2> <p>The StoragePowerActor state is the same in v0 and v2.</p> <h3 id="v0-9"><a href="#v0-9" class="header-anchor">#</a> v0</h3> <p><a name="powerv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  TotalRawBytePower StoragePower
  <span class="token comment"># TotalBytesCommitted includes claims from miners below min power threshold</span>
  TotalBytesCommitted StoragePower
  TotalQualityAdjPower StoragePower
  <span class="token comment"># TotalQABytesCommitted includes claims from miners below min power threshold</span>
  TotalQABytesCommitted StoragePower
  TotalPledgeCollateral TokenAmount
  <span class="token comment"># These fields are set once per epoch in the previous cron tick and used</span>
  <span class="token comment"># for consistent values across a single epoch's state transition.</span>
  ThisEpochRawBytePower StoragePower
  ThisEpochQualityAdjPower StoragePower
  ThisEpochPledgeCollateral TokenAmount
  ThisEpochQAPowerSmoothed <span class="token keyword">nullable</span> FilterEstimate
  MinerCount Int
  <span class="token comment"># Number of miners having proven the minimum consensus power</span>
  MinerAboveMinPowerCount Int
  <span class="token comment"># A queue of events to be triggered by cron, indexed by epoch</span>
  CronEventQueue <span class="token punctuation">&amp;</span>PowerV0CronEventHAMT <span class="token comment"># Multimap: HAMT[ChainEpoch]AMT[PowerV0CronEvent]</span>
  <span class="token comment"># First epoch in which a cron task may be stored.</span>
  <span class="token comment"># Cron will iterate every epoch between this and the current epoch inclusively to find tasks to execute.</span>
  FirstCronEpoch ChainEpoch
  <span class="token comment"># Last epoch power cron tick has been processed</span>
  LastProcessedCronEpoch ChainEpoch
  <span class="token comment"># Claimed power for each miner</span>
  Claims <span class="token punctuation">&amp;</span>PowerV0ClaimHAMT <span class="token comment"># HAMT[address]PowerV0Claim</span>
  ProofValidationBatch <span class="token keyword">nullable</span> <span class="token punctuation">&amp;</span>ProofValidationBatchHAMT <span class="token comment"># Multimap: HAMT[Address]AMT[SealVerifyInfo]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-9"><a href="#v2-9" class="header-anchor">#</a> v2</h3> <p><a name="powerv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV2State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  TotalRawBytePower StoragePower
  <span class="token comment"># TotalBytesCommitted includes claims from miners below min power threshold</span>
  TotalBytesCommitted StoragePower
  TotalQualityAdjPower StoragePower
  <span class="token comment"># TotalQABytesCommitted includes claims from miners below min power threshold</span>
  TotalQABytesCommitted StoragePower
  TotalPledgeCollateral TokenAmount
  <span class="token comment"># These fields are set once per epoch in the previous cron tick and used</span>
  <span class="token comment"># for consistent values across a single epoch's state transition.</span>
  ThisEpochRawBytePower StoragePower
  ThisEpochQualityAdjPower StoragePower
  ThisEpochPledgeCollateral TokenAmount
  ThisEpochQAPowerSmoothed FilterEstimate
  MinerCount Int
  <span class="token comment"># Number of miners having proven the minimum consensus power</span>
  MinerAboveMinPowerCount Int
  <span class="token comment"># A queue of events to be triggered by cron, indexed by epoch</span>
  CronEventQueue <span class="token punctuation">&amp;</span>PowerV0CronEventHAMT <span class="token comment"># Multimap: HAMT[ChainEpoch]AMT[PowerV0CronEvent]</span>
  <span class="token comment"># First epoch in which a cron task may be stored.</span>
  <span class="token comment"># Cron will iterate every epoch between this and the current epoch inclusively to find tasks to execute.</span>
  FirstCronEpoch ChainEpoch
  <span class="token comment"># Claimed power for each miner</span>
  Claims <span class="token punctuation">&amp;</span>PowerV2ClaimHAMT <span class="token comment"># HAMT[address]PowerV2Claim</span>
  ProofValidationBatch <span class="token keyword">nullable</span> <span class="token punctuation">&amp;</span>ProofValidationBatchHAMT <span class="token comment"># Multimap: HAMT[Address]AMT[SealVerifyInfo]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>Multimap (HAMT+AMT)</strong>: This is an ADL representing a List within a Map <code>type PowerV0CronEventMap {ChainEpochBytes:[PowerV0CronEvent]}</code>, where the <code>CronEvent</code> list is a queue.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># HAMT/map root structure</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0CronEventHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> PowerV0CronEventHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0CronEventHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> PowerV0CronEventHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> PowerV0CronEventHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0CronEventHAMTLink</span></span> <span class="token punctuation">&amp;</span>PowerV0CronEventHAMTLink

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0CronEventHAMTBucket</span></span> <span class="token punctuation">[</span> PowerV0CronEventHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0CronEventHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key ChainEpochBytes
  value <span class="token punctuation">&amp;</span>PowerV0CronEventAMT
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># AMT/set leaf structure (list of CronEvents)</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0CronEventAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node PowerV0CronEventAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># This can also be the root of a block</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0CronEventAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>PowerV0CronEventAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>PowerV0CronEvent<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0CronEvent</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  MinerAddr Address
  CallbackPayload Bytes
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>HAMT</strong>: This is an ADL representing <code>type PowerV0ClaimMap {Address:PowerV0Claim}</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0ClaimMapHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> PowerV0ClaimMapHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0ClaimMapHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> PowerV0ClaimMapHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> PowerV0ClaimMapHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0ClaimMapHAMTLink</span></span> <span class="token punctuation">&amp;</span>PowerV0ClaimMapHAMT

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0ClaimMapHAMTBucket</span></span> <span class="token punctuation">[</span> PowerV0ClaimMapHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0ClaimMapHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key Address
  value PowerV0Claim
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV0Claim</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Sum of raw byte power for a miner's sectors</span>
  RawBytePower StoragePower
  <span class="token comment"># Sum of quality adjusted power for a miner's sectors</span>
  QualityAdjPower StoragePower
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>HAMT</strong>: This is an ADL representing <code>type PowerV2ClaimMap {Address:PowerV2Claim}</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV2ClaimMapHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> PowerV2ClaimMapHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV2ClaimMapHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> PowerV2ClaimMapHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> PowerV2ClaimMapHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV2ClaimMapHAMTLink</span></span> <span class="token punctuation">&amp;</span>PowerV2ClaimMapHAMT

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV2ClaimMapHAMTBucket</span></span> <span class="token punctuation">[</span> PowerV2ClaimMapHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV2ClaimMapHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key Address
  value PowerV2Claim
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">PowerV2Claim</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Miner's proof type used to determine minimum miner size</span>
  SealProofType RegisteredSealProof
  <span class="token comment"># Sum of raw byte power for a miner's sectors</span>
  RawBytePower StoragePower
  <span class="token comment"># Sum of quality adjusted power for a miner's sectors</span>
  QualityAdjPower StoragePower
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><p><strong>Multimap (HAMT+AMT)</strong>: This is an ADL representing a List within a Map <code>type ProofValidationBatchMap {Address:[SealVerifyInfo]}</code>, where <code>SealVerifyInfo</code> is a queue.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token comment"># HAMT/map root structure</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ProofValidationBatchHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> ProofValidationBatchHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ProofValidationBatchHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> ProofValidationBatchHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> ProofValidationBatchHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ProofValidationBatchHAMTLink</span></span> <span class="token punctuation">&amp;</span>ProofValidationBatchHAMTLink

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ProofValidationBatchHAMTBucket</span></span> <span class="token punctuation">[</span> ProofValidationBatchHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ProofValidationBatchHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key Address
  value <span class="token punctuation">&amp;</span>ProofValidationBatchAMT
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># AMT/set leaf structure (list of CronEvents)</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ProofValidationBatchAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  height Int
  count Int
  node ProofValidationBatchAMTNode
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># This can also be the root of a block</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">ProofValidationBatchAMTNode</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  bitmap Bytes
  children <span class="token punctuation">[</span><span class="token punctuation">&amp;</span>ProofValidationBatchAMTNode<span class="token punctuation">]</span>
  values <span class="token punctuation">[</span>SealVerifyInfo<span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token comment"># Information needed to verify a seal proof.</span>
<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">SealVerifyInfo</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  SealProof RegisteredSealProof
  SectorID SectorID
  DealIDs <span class="token punctuation">[</span>DealID<span class="token punctuation">]</span>
  Randomness Bytes
  InteractiveRandomness Bytes
  Proof Bytes
  <span class="token comment"># Safe because we get those from the miner actor</span>
  SealedCID <span class="token punctuation">&amp;</span>Any <span class="token comment"># CommR: A CID with fil-commitment-sealed + poseidon-bls12_381-ac-fc1</span>
  UnsealedCID <span class="token punctuation">&amp;</span>Any <span class="token comment"># CommD: A CID with fil-commitment-unsealed + sha2_256-trunc254-padded</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h2 id="verifiedregistryactor"><a href="#verifiedregistryactor" class="header-anchor">#</a> VerifiedRegistryActor</h2> <p>The VerifiedRegistryActor state is the same in v0 and v2.</p> <h3 id="v0-10"><a href="#v0-10" class="header-anchor">#</a> v0</h3> <p><a name="verifregv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">VerifregV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  <span class="token comment"># Root key holder multisig.</span>
  <span class="token comment"># Authorize and remove verifiers.</span>
  RootKey Address
  <span class="token comment"># Verifiers authorize VerifiedClients.</span>
  <span class="token comment"># Verifiers delegate their DataCap.</span>
  Verifiers <span class="token punctuation">&amp;</span>DataCapHAMT
  <span class="token comment"># VerifiedClients can add VerifiedClientData, up to DataCap.</span>
  VerifiedClients <span class="token punctuation">&amp;</span>DataCapHAMT
<span class="token punctuation">}</span>
</code></pre></div><h3 id="v2-10"><a href="#v2-10" class="header-anchor">#</a> v2</h3> <p><em>(Same as v0)</em></p> <p><a name="verifregv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">VerifregV2State</span></span> VerifregV0State
</code></pre></div><p><strong>HAMT</strong>: This is an ADL representing <code>type DataCapMap {Address:StoragePower}</code>.</p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DataCapHAMT</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  map Bytes
  data <span class="token punctuation">[</span> DataCapHAMTElement <span class="token punctuation">]</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DataCapHAMTElement</span></span> <span class="token builtin">union</span> <span class="token punctuation">{</span>
  <span class="token punctuation">|</span> DataCapHAMTLink <span class="token string">&quot;0&quot;</span>
  <span class="token punctuation">|</span> DataCapHAMTBucket <span class="token string">&quot;1&quot;</span>
<span class="token representation">} <span class="token builtin">representation</span></span> keyed

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DataCapHAMTLink</span></span> <span class="token punctuation">&amp;</span>DataCapHAMT

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DataCapHAMTBucket</span></span> <span class="token punctuation">[</span> DataCapHAMTBucketEntry <span class="token punctuation">]</span>

<span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">DataCapHAMTBucketEntry</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
  key Address
  value DataCap <span class="token comment"># inline</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h2 id="systemactor"><a href="#systemactor" class="header-anchor">#</a> SystemActor</h2> <p>Note that <code>SystemV0State</code> is an empty struct, which encodes as an empty CBOR array (<code>0x80</code>).</p> <p>The SystemActor state is the same in v0 and v2.</p> <h3 id="v0-11"><a href="#v0-11" class="header-anchor">#</a> v0</h3> <p><a name="systemv0state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">SystemV0State</span></span> <span class="token builtin">struct</span> <span class="token punctuation">{</span>
<span class="token representation">} <span class="token builtin">representation</span></span> tuple
</code></pre></div><h3 id="v2-11"><a href="#v2-11" class="header-anchor">#</a> v2</h3> <p><em>(Same as v0)</em></p> <p><a name="systemv2state"></a></p> <div class="language-ipldsch extra-class"><pre class="language-ipldsch"><code><span class="token typedef"><span class="token keyword">type</span> <span class="token class-name">SystemV2State</span></span> SystemV0State
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipld/specs/edit/master/data-structures/filecoin/state.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/20/2021, 4:46:27 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.322f50e4.js" defer></script><script src="/assets/js/2.c9aef7ee.js" defer></script><script src="/assets/js/35.3d9e8823.js" defer></script>
  </body>
</html>
